class InoBillPWA{constructor(){this.deferredPrompt=null,this.isInstalled=!1,this.isOnline=navigator.onLine,this.serviceWorker=null,this.init()}async init(){await this.registerServiceWorker(),this.setupInstallPrompt(),this.setupUpdateHandling(),this.setupOnlineOfflineHandling(),this.setupPWAUI(),this.checkInstallationStatus()}async registerServiceWorker(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("./sw.min.js",{scope:"./"});this.serviceWorker=e,e.addEventListener("updatefound",(()=>{const t=e.installing;t&&t.addEventListener("statechange",(()=>{"installed"===t.state&&navigator.serviceWorker.controller&&this.showUpdateBanner()}))}))}catch(e){}}setupInstallPrompt(){window.addEventListener("beforeinstallprompt",(e=>{this.deferredPrompt=e;localStorage.getItem("inobill-banner-dismissed")||setTimeout((()=>{this.showInstallBanner()}),3e3)})),window.addEventListener("appinstalled",(()=>{this.isInstalled=!0,this.hideInstallBanner(),this.showInstallSuccessMessage()}))}setupUpdateHandling(){"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",(()=>{this.hideUpdateBanner(),this.showUpdateSuccessMessage()}))}setupOnlineOfflineHandling(){window.addEventListener("online",(()=>{this.isOnline=!0,this.hideOfflineIndicator(),this.showOnlineStatus()})),window.addEventListener("offline",(()=>{this.isOnline=!1,this.showOfflineIndicator(),this.showOfflineStatus()})),this.isOnline?this.hideOfflineIndicator():this.showOfflineIndicator()}setupPWAUI(){const e=document.getElementById("pwa-install-btn");e&&e.addEventListener("click",(()=>this.installApp()));const t=document.getElementById("pwa-dismiss-btn");t&&t.addEventListener("click",(()=>this.dismissInstallBanner()));const s=document.getElementById("pwa-update-btn");s&&s.addEventListener("click",(()=>this.updateApp()));const a=document.getElementById("pwa-update-dismiss-btn");a&&a.addEventListener("click",(()=>this.hideUpdateBanner()));const i=document.getElementById("pwa-install-link");i&&i.addEventListener("click",(e=>{e.preventDefault(),this.installApp()}))}checkInstallationStatus(){(window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone)&&(this.isInstalled=!0,this.hideInstallBanner())}showInstallBanner(){if(this.isInstalled)return;const e=document.getElementById("pwa-install-banner");e&&(e.style.display="block",e.classList.add("show"),document.querySelector(".container").classList.add("with-banner"))}hideInstallBanner(){const e=document.getElementById("pwa-install-banner");e&&(e.classList.remove("show"),setTimeout((()=>{e.style.display="none"}),300),document.querySelector(".container").classList.remove("with-banner"))}dismissInstallBanner(){localStorage.setItem("inobill-banner-dismissed","true"),this.hideInstallBanner()}showUpdateBanner(){const e=document.getElementById("pwa-update-banner");e&&(e.style.display="block",document.querySelector(".container").classList.add("with-banner"))}hideUpdateBanner(){const e=document.getElementById("pwa-update-banner");e&&(e.style.display="none",document.querySelector(".container").classList.remove("with-banner"))}showOfflineIndicator(){const e=document.getElementById("offline-indicator");e&&(e.style.display="block")}hideOfflineIndicator(){const e=document.getElementById("offline-indicator");e&&(e.style.display="none")}async installApp(){if(this.deferredPrompt)try{this.deferredPrompt.prompt();const{outcome:e}=await this.deferredPrompt.userChoice;"accepted"===e&&this.showInstallSuccessMessage(),this.deferredPrompt=null,this.hideInstallBanner()}catch(e){this.showInstallError()}else this.showInstallError()}async updateApp(){this.serviceWorker&&this.serviceWorker.waiting&&this.serviceWorker.waiting.postMessage({type:"SKIP_WAITING"})}showInstallSuccessMessage(){this.showStatusMessage("InoBill berhasil diinstall! ðŸŽ‰","success")}showUpdateSuccessMessage(){this.showStatusMessage("InoBill berhasil diupdate! ðŸ”„","success")}showInstallError(){this.showStatusMessage("Gagal menginstall InoBill. Coba lagi nanti.","error")}showOnlineStatus(){this.showStatusMessage("Koneksi internet tersedia","online")}showOfflineStatus(){this.showStatusMessage("Tidak ada koneksi internet","offline")}showStatusMessage(e,t="info"){const s=document.querySelector(".pwa-status");s&&s.remove();const a=document.createElement("div");a.className=`pwa-status ${t}`,a.textContent=e,document.body.appendChild(a),setTimeout((()=>{a.parentNode&&a.remove()}),3e3)}async shareData(e){if(navigator.share)try{await navigator.share({title:"InoBill - Split Bill Calculator",text:"Lihat hasil perhitungan split bill",url:window.location.href})}catch(e){}else this.copyToClipboard(e)}async copyToClipboard(e){try{await navigator.clipboard.writeText(e),this.showStatusMessage("Data disalin ke clipboard","success")}catch(e){this.showStatusMessage("Gagal menyalin data","error")}}exportData(){const e={participants:JSON.parse(localStorage.getItem("inobill_participants")||"[]"),menuItems:JSON.parse(localStorage.getItem("inobill_menuItems")||"[]"),additionalCosts:JSON.parse(localStorage.getItem("inobill_additionalCosts")||"[]"),orders:JSON.parse(localStorage.getItem("inobill_orders")||"{}"),discount:JSON.parse(localStorage.getItem("inobill_discount")||"{}"),timestamp:(new Date).toISOString()},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`inobill-data-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s),this.showStatusMessage("Data berhasil diekspor","success")}importData(e){const t=new FileReader;t.onload=e=>{try{const t=JSON.parse(e.target.result);this.validateImportedData(t)?(localStorage.setItem("inobill_participants",JSON.stringify(t.participants||[])),localStorage.setItem("inobill_menuItems",JSON.stringify(t.menuItems||[])),localStorage.setItem("inobill_additionalCosts",JSON.stringify(t.additionalCosts||[])),localStorage.setItem("inobill_orders",JSON.stringify(t.orders||{})),localStorage.setItem("inobill_discount",JSON.stringify(t.discount||{})),window.location.reload(),this.showStatusMessage("Data berhasil diimpor","success")):this.showStatusMessage("Format data tidak valid","error")}catch(e){this.showStatusMessage("Gagal mengimpor data","error")}},t.readAsText(e)}validateImportedData(e){return e&&Array.isArray(e.participants)&&Array.isArray(e.menuItems)&&Array.isArray(e.additionalCosts)&&"object"==typeof e.orders&&"object"==typeof e.discount}clearAllData(){confirm("Hapus semua data? Tindakan ini tidak dapat dibatalkan.")&&(localStorage.removeItem("inobill_participants"),localStorage.removeItem("inobill_menuItems"),localStorage.removeItem("inobill_additionalCosts"),localStorage.removeItem("inobill_orders"),localStorage.removeItem("inobill_discount"),window.location.reload(),this.showStatusMessage("Semua data berhasil dihapus","success"))}getAppInfo(){return{name:"InoBill PWA",version:"1.1.0",isInstalled:this.isInstalled,isOnline:this.isOnline,hasServiceWorker:!!this.serviceWorker,userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language}}resetBannerDismiss(){localStorage.removeItem("inobill-banner-dismissed")}resetAllInstallStatus(){localStorage.removeItem("inobill-banner-dismissed")}forceShowInstallBanner(){this.deferredPrompt&&this.showInstallBanner()}}document.addEventListener("DOMContentLoaded",(()=>{window.inobillPWA=new InoBillPWA})),window.InoBillPWA=InoBillPWA;
let participants=[],menuItems=[],additionalCosts=[],orders={},discount={amount:0,percentage:0,type:"menu"};function formatCurrency(t){return Math.round(t).toLocaleString("id-ID")}function init(){loadDataFromUrl()||loadData(),setupEventListeners(),setupFloatingButton(),setupModernSelects(),renderAll(),checkForUpdates()}function loadData(){try{const t=localStorage.getItem("inobill_participants"),n=localStorage.getItem("inobill_menuItems"),e=localStorage.getItem("inobill_additionalCosts"),a=localStorage.getItem("inobill_orders"),o=localStorage.getItem("inobill_discount");t&&(participants=JSON.parse(t)),n&&(menuItems=JSON.parse(n)),e&&(additionalCosts=JSON.parse(e)),a&&(orders=JSON.parse(a)),o&&(discount=JSON.parse(o))}catch(t){}}function saveData(){try{localStorage.setItem("inobill_participants",JSON.stringify(participants)),localStorage.setItem("inobill_menuItems",JSON.stringify(menuItems)),localStorage.setItem("inobill_additionalCosts",JSON.stringify(additionalCosts)),localStorage.setItem("inobill_orders",JSON.stringify(orders)),localStorage.setItem("inobill_discount",JSON.stringify(discount))}catch(t){}}async function resetAllData(){if((await Swal.fire({title:"üîÑ Reset Semua Data",html:'\n            <div style="text-align: left; margin: 20px 0;">\n                <p style="margin-bottom: 15px; font-size: 16px; color: #374151;">\n                    Apakah Anda yakin ingin mengosongkan semua data?\n                </p>\n                <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 15px 0;">\n                    <p style="margin: 0; font-weight: 600; color: #ef4444; margin-bottom: 10px;">Data yang akan dihapus:</p>\n                    <ul style="margin: 0; padding-left: 20px; color: #6b7280;">\n                        <li>Semua peserta</li>\n                        <li>Semua menu</li>\n                        <li>Semua biaya tambahan</li>\n                        <li>Semua pesanan</li>\n                        <li>Semua diskon</li>\n                    </ul>\n                </div>\n                <p style="margin: 0; font-size: 14px; color: #ef4444; font-weight: 600;">\n                    ‚ö†Ô∏è Tindakan ini tidak dapat dibatalkan!\n                </p>\n            </div>\n        ',icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Reset Semua",cancelButtonText:"Batal",confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",reverseButtons:!0,focusCancel:!0,customClass:{popup:"swal2-popup-custom",title:"swal2-title-custom",htmlContainer:"swal2-html-container-custom"}})).isConfirmed){Swal.fire({title:"Sedang mereset...",text:"Menghapus semua data...",icon:"info",allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>{Swal.showLoading()}}),await new Promise((t=>setTimeout(t,1e3))),participants=[],menuItems=[],additionalCosts=[],orders={},discount={amount:0,percentage:0,type:"menu"};const t=document.getElementById("participantName"),n=document.getElementById("menuName"),e=document.getElementById("menuPrice"),a=document.getElementById("additionalCostName"),o=document.getElementById("additionalCostAmount"),i=document.getElementById("discountAmount"),r=document.getElementById("discountPercentage");t&&(t.value=""),n&&(n.value=""),e&&(e.value=""),a&&(a.value=""),o&&(o.value=""),i&&(i.value=""),r&&(r.value=""),resetCustomSelect("discountType","menu","Setelah Menu"),resetCustomSelect("additionalCostType","fixed","Tetap (Rp)");try{localStorage.removeItem("inobill_participants"),localStorage.removeItem("inobill_menuItems"),localStorage.removeItem("inobill_additionalCosts"),localStorage.removeItem("inobill_orders"),localStorage.removeItem("inobill_discount")}catch(t){}renderAll(),await Swal.fire({title:"‚úÖ Berhasil!",text:"Semua data telah direset dengan sukses!",icon:"success",timer:2e3,timerProgressBar:!0,showConfirmButton:!1})}}function setupEventListeners(){const t=document.getElementById("discountAmount"),n=document.getElementById("discountPercentage");t&&n&&(t.addEventListener("input",toggleDiscountFields),n.addEventListener("input",toggleDiscountFields)),document.addEventListener("input",debounce(saveData,1e3)),document.addEventListener("change",debounce(saveData,1e3)),window.addEventListener("online",handleOnlineStatus),window.addEventListener("offline",handleOfflineStatus),window.addEventListener("beforeunload",saveData)}function setupFloatingButton(){const t=document.getElementById("floating-reset-btn");if(t){t.addEventListener("click",(function(){this.style.transform="scale(0.95)",setTimeout((()=>{this.style.transform=""}),150)})),t.addEventListener("mouseenter",(function(){this.style.transform="translateY(-2px) scale(1.05)"})),t.addEventListener("mouseleave",(function(){this.style.transform=""}));let n=0;window.addEventListener("scroll",(function(){const e=window.pageYOffset||document.documentElement.scrollTop;e>n&&e>100?(t.style.transform="translateY(100px)",t.style.opacity="0.7"):(t.style.transform="",t.style.opacity="1"),n=e}))}}function setupModernSelects(){setupCustomSelects();document.querySelectorAll("select").forEach((t=>{t.addEventListener("change",(function(){this.style.transform="scale(0.98)",setTimeout((()=>{this.style.transform=""}),150)}))}))}function setupCustomSelects(){document.querySelectorAll(".custom-select").forEach((t=>{const n=t.querySelector(".select-trigger");t.querySelector(".select-options");n.addEventListener("mouseenter",(function(){t.classList.add("select-hovered")})),n.addEventListener("mouseleave",(function(){t.classList.remove("select-hovered")})),n.addEventListener("focus",(function(){t.classList.add("select-focused")})),n.addEventListener("blur",(function(){t.classList.remove("select-focused")})),n.addEventListener("keydown",(function(n){"Enter"!==n.key&&" "!==n.key||(n.preventDefault(),toggleSelect(t.id||"customSelect"))}))})),document.addEventListener("click",(function(t){t.target.closest(".custom-select")||closeAllSelects()}))}function toggleSelect(t){const n=document.getElementById(t)||document.querySelector(`[onclick*="${t}"]`).closest(".custom-select"),e=n.querySelector(".select-trigger"),a=n.querySelector(".select-options");closeAllSelects(),a.classList.contains("show")?(a.classList.remove("show"),e.classList.remove("active")):(a.classList.add("show"),e.classList.add("active"))}function selectOption(t,n,e){const a=document.getElementById(t)||document.querySelector(`[onclick*="${t}"]`).closest(".custom-select"),o=a.querySelector(".select-trigger"),i=a.querySelector(".select-options"),r=a.querySelector(".select-value"),s=a.querySelectorAll(".select-option");if(r.textContent=e,s.forEach((t=>{t.classList.remove("selected"),t.dataset.value===n&&t.classList.add("selected")})),i.classList.remove("show"),o.classList.remove("active"),o.style.transform="scale(0.98)",setTimeout((()=>{o.style.transform=""}),150),"discountType"===t){showNotification("menu"===n?"Diskon akan diterapkan setelah menu":"Diskon akan diterapkan dari total semua","info")}if("additionalCostType"===t){showNotification("fixed"===n?"Biaya tambahan akan dihitung sebagai jumlah tetap":"Biaya tambahan akan dihitung sebagai persentase","info")}const l=new Event("change",{bubbles:!0});a.dispatchEvent(l)}function closeAllSelects(){document.querySelectorAll(".custom-select").forEach((t=>{const n=t.querySelector(".select-trigger");t.querySelector(".select-options").classList.remove("show"),n.classList.remove("active")}))}function getCustomSelectValue(t){try{const n=document.getElementById(t)||document.querySelector(`[onclick*="${t}"]`)?.closest(".custom-select");if(!n)return null;const e=n.querySelector(".select-option.selected");return e?e.dataset.value:null}catch(t){return null}}function resetCustomSelect(t,n,e){try{const a=document.getElementById(t)||document.querySelector(`[onclick*="${t}"]`)?.closest(".custom-select");if(!a)return;const o=a.querySelector(".select-value"),i=a.querySelectorAll(".select-option");o&&(o.textContent=e),i.forEach((t=>{t.classList.remove("selected"),t.dataset.value===n&&t.classList.add("selected")}))}catch(t){}}function toggleDiscountFields(){const t=document.getElementById("discountAmount"),n=document.getElementById("discountPercentage"),e=document.getElementById("discountInfo");if(!t||!n||!e)return;const a=parseFloat(t.value)||0,o=parseFloat(n.value)||0;a>0&&o>0?(n.value="",discount.percentage=0,e.textContent="Menggunakan diskon (prioritas)",e.style.display="block"):a>0?(n.disabled=!0,discount.percentage=0,e.textContent="Menggunakan diskon Rp",e.style.display="block"):o>0?(t.disabled=!0,discount.amount=0,e.textContent="Menggunakan diskon %",e.style.display="block"):(t.disabled=!1,n.disabled=!1,e.style.display="none"),discount.amount=a,discount.percentage=o;try{discount.type=getCustomSelectValue("discountType")||"menu"}catch(t){discount.type="menu"}calculateSplit()}function addParticipant(){const t=document.getElementById("participantName"),n=t.value.trim();return n?participants.includes(n)?(showError("Error Input","Peserta sudah ada"),void t.focus()):(participants.push(n),orders[n]=[],t.value="",renderParticipants(),renderOrders(),calculateSplit(),saveData(),void showNotification(`${n} berhasil ditambahkan sebagai peserta`,"success")):(showError("Error Input","Masukkan nama peserta"),void t.focus())}async function removeParticipant(t){await showConfirmation("Hapus Peserta",`Apakah Anda yakin ingin menghapus "${t}"?`,"Ya, Hapus","Batal")&&(participants=participants.filter((n=>n!==t)),delete orders[t],renderParticipants(),renderOrders(),calculateSplit(),saveData(),showNotification(`${t} telah dihapus`,"success"))}function addMenuItem(){const t=document.getElementById("menuName"),n=document.getElementById("menuPrice"),e=t.value.trim(),a=parseFloat(n.value)||0;return e?a<=0?(showError("Error Input","Masukkan harga yang valid"),void n.focus()):(menuItems.push({name:e,price:a}),t.value="",n.value="",renderMenuItems(),renderOrders(),calculateSplit(),saveData(),void showNotification(`Menu "${e}" berhasil ditambahkan`,"success")):(showError("Error Input","Masukkan nama menu"),void t.focus())}async function removeMenuItem(t){const n=menuItems[t]?.name||"menu ini";await showConfirmation("Hapus Menu",`Apakah Anda yakin ingin menghapus "${n}"?`,"Ya, Hapus","Batal")&&(menuItems.splice(t,1),Object.keys(orders).forEach((n=>{orders[n]=orders[n].filter((n=>n.menuIndex!==t))})),renderMenuItems(),renderOrders(),calculateSplit(),saveData(),showNotification(`Menu "${n}" telah dihapus`,"success"))}function addAdditionalCost(){const t=document.getElementById("additionalCostName"),n=document.getElementById("additionalCostAmount"),e=t.value.trim(),a=parseFloat(n.value)||0;let o="fixed";try{o=getCustomSelectValue("additionalCostType")||"fixed"}catch(t){o="fixed"}return e?a<=0?(showError("Error Input","Masukkan jumlah yang valid"),void n.focus()):(additionalCosts.push({name:e,amount:a,type:o}),t.value="",n.value="",renderAdditionalCosts(),calculateSplit(),saveData(),void showNotification(`Biaya tambahan "${e}" berhasil ditambahkan`,"success")):(showError("Error Input","Masukkan nama biaya tambahan"),void t.focus())}async function removeAdditionalCost(t){const n=additionalCosts[t]?.name||"biaya tambahan ini";await showConfirmation("Hapus Biaya Tambahan",`Apakah Anda yakin ingin menghapus "${n}"?`,"Ya, Hapus","Batal")&&(additionalCosts.splice(t,1),renderAdditionalCosts(),calculateSplit(),saveData(),showNotification(`Biaya tambahan "${n}" telah dihapus`,"success"))}function toggleOrder(t,n){orders[t]||(orders[t]=[]);const e=orders[t].findIndex((t=>t.menuIndex===n));e>=0?orders[t].splice(e,1):orders[t].push({menuIndex:n,quantity:1}),renderOrders(),calculateSplit(),saveData()}function updateOrderQuantity(t,n,e){orders[t]||(orders[t]=[]);const a=orders[t].findIndex((t=>t.menuIndex===n));a>=0?e<=0?orders[t].splice(a,1):orders[t][a].quantity=e:e>0&&orders[t].push({menuIndex:n,quantity:e}),renderOrders(),calculateSplit(),saveData()}function renderParticipants(){const t=document.getElementById("participantsList");t&&(0!==participants.length?t.innerHTML=participants.map((t=>`\n        <div class="participant-item">\n            <span>${t}</span>\n            <button onclick="removeParticipant('${t}')" class="remove-btn">Hapus</button>\n        </div>\n    `)).join(""):t.innerHTML='<p class="empty-state">Belum ada peserta</p>')}function renderMenuItems(){const t=document.getElementById("menuList");t&&(0!==menuItems.length?t.innerHTML=menuItems.map(((t,n)=>`\n        <div class="menu-item">\n            <span class="name">${t.name}</span>\n            <span class="price">${formatCurrency(t.price)}</span>\n            <button onclick="removeMenuItem(${n})" class="remove-btn">Hapus</button>\n        </div>\n    `)).join(""):t.innerHTML='<p class="empty-state">Belum ada menu</p>')}function renderAdditionalCosts(){const t=document.getElementById("additionalCostsList");t&&(0!==additionalCosts.length?t.innerHTML=additionalCosts.map(((t,n)=>`\n        <div class="additional-cost-item">\n            <span class="name">${t.name}</span>\n            <span class="amount">${"percentage"===t.type?t.amount+"%":formatCurrency(t.amount)}</span>\n            <button onclick="removeAdditionalCost(${n})" class="remove-btn">Hapus</button>\n        </div>\n    `)).join(""):t.innerHTML='<p class="empty-state">Belum ada biaya tambahan</p>')}function renderOrders(){const t=document.getElementById("ordersList");t&&(0!==participants.length&&0!==menuItems.length?t.innerHTML=participants.map((t=>`\n        <div class="participant-orders">\n            <h3>${t}</h3>\n            <div class="order-items">\n                ${menuItems.map(((n,e)=>{const a=orders[t]?.find((t=>t.menuIndex===e)),o=a?a.quantity:0;return`\n                        <div class="order-item">\n                            <label>\n                                <input type="checkbox" \n                                       ${o>0?"checked":""} \n                                       onchange="toggleOrder('${t}', ${e})">\n                                ${n.name} - ${formatCurrency(n.price)}\n                            </label>\n                            ${o>0?`\n                                <div class="quantity-controls">\n                                    <button onclick="updateOrderQuantity('${t}', ${e}, ${o-1})">-</button>\n                                    <span>${o}</span>\n                                    <button onclick="updateOrderQuantity('${t}', ${e}, ${o+1})">+</button>\n                                </div>\n                            `:""}\n                        </div>\n                    `})).join("")}\n            </div>\n        </div>\n    `)).join(""):t.innerHTML='<p class="empty-state">Tambahkan peserta dan menu terlebih dahulu</p>')}function calculateSplit(){if(0===participants.length||0===menuItems.length){document.getElementById("results").innerHTML='<p class="empty-state">Tambahkan peserta dan menu terlebih dahulu</p>';const t=document.getElementById("actionButtons");return void(t&&(t.style.display="none"))}let t=0;if(Object.keys(orders).forEach((n=>{orders[n].forEach((n=>{const e=menuItems[n.menuIndex];e&&(t+=e.price*n.quantity)}))})),0===t){document.getElementById("results").innerHTML='<p class="empty-state">Belum ada pesanan</p>';const t=document.getElementById("actionButtons");return void(t&&(t.style.display="none"))}let n=0;additionalCosts.forEach((e=>{"fixed"===e.type?n+=e.amount:"percentage"===e.type&&(n+=t*e.amount/100)}));let e=0;discount.amount>0?e=discount.amount:discount.percentage>0&&(e="menu"===discount.type?t*discount.percentage/100:(t+n)*discount.percentage/100);const a=(t+n-e)/t,o=[];Object.keys(orders).forEach((t=>{let n=0;if(orders[t].forEach((t=>{const e=menuItems[t.menuIndex];e&&(n+=e.price*t.quantity)})),n>0){const e=n*a;o.push({participant:t,originalAmount:n,adjustedAmount:e})}})),displayResults(o,{totalSubtotal:t,totalAdditionalCosts:n,totalDiscount:e,factor:a,totalBill:t+n-e})}function displayResults(t,n){const e=document.getElementById("results");if(!e)return;const a=t.map((t=>`\n        <div class="participant-result">\n            <h3>${t.participant}</h3>\n            <div class="result-details">\n                <div class="amount-breakdown">\n                    <span>Makanan: ${formatCurrency(t.originalAmount)}</span>\n                    <span>Total: ${formatCurrency(t.adjustedAmount)}</span>\n                </div>\n            </div>\n        </div>\n    `)).join(""),o=`\n        <div class="total-summary">\n            <h3>Grand Total: ${formatCurrency(n.totalBill)}</h3>\n            <div class="summary-breakdown">\n                <p>Subtotal: ${formatCurrency(n.totalSubtotal)}</p>\n                <p>Biaya Tambahan: ${formatCurrency(n.totalAdditionalCosts)}</p>\n                <p>Diskon: -${formatCurrency(n.totalDiscount)}</p>\n            </div>\n        </div>\n    `,i=`\n        <div style="margin-top: 20px; font-size: 0.9em; border: 2px solid #0174BE; border-radius: 8px; padding: 15px; background: #ffffff;">\n            <div style="color: #0174BE; font-weight: bold; font-size: 1.1em; margin-bottom: 15px; text-align: center;">\n                üî¢ Proses Perhitungan dengan Faktor Pembagi\n            </div>\n            <div style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px; border-left: 4px solid #0174BE;">\n                <div style="font-weight: bold; color: #0174BE; margin-bottom: 5px;">üìê Formula Faktor Pembagi:</div>\n                <div style="font-family: monospace; background: #e9ecef; color: #212529; padding: 8px; border-radius: 3px; margin: 5px 0;">\n                    (Total Subtotal + Biaya Tambahan - Diskon) √∑ Total Subtotal = <strong style="color: #dc3545;">${n.factor.toFixed(4)}</strong>\n                </div>\n                <div style="font-weight: bold; color: #0174BE; margin-top: 8px;">üí∞ Harga Baru:</div>\n                <div style="font-family: monospace; background: #e9ecef; color: #212529; padding: 8px; border-radius: 3px; margin: 5px 0;">\n                    Harga Asli √ó Faktor Pembagi\n                </div>\n            </div>\n        </div>\n    `;e.innerHTML=a+o+i;const r=document.getElementById("actionButtons");r&&(r.style.display="flex")}function renderAll(){renderParticipants(),renderMenuItems(),renderAdditionalCosts(),renderOrders(),calculateSplit()}function handleOnlineStatus(){hideOfflineIndicator(),syncData()}function handleOfflineStatus(){showOfflineIndicator()}function showOfflineIndicator(){const t=document.getElementById("offline-indicator");t&&(t.style.display="block")}function hideOfflineIndicator(){const t=document.getElementById("offline-indicator");t&&(t.style.display="none")}function syncData(){}function checkForUpdates(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((t=>{t.update()}))}function debounce(t,n){let e;return function(...a){clearTimeout(e),e=setTimeout((()=>{clearTimeout(e),t(...a)}),n)}}function formatCurrency(t){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t)}function showNotification(t,n="info"){const e={toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:t=>{t.addEventListener("mouseenter",Swal.stopTimer),t.addEventListener("mouseleave",Swal.resumeTimer)}};switch(n){case"success":Swal.fire({...e,icon:"success",title:"Berhasil!",text:t});break;case"error":Swal.fire({...e,icon:"error",title:"Error!",text:t});break;case"warning":Swal.fire({...e,icon:"warning",title:"Peringatan!",text:t});break;case"info":default:Swal.fire({...e,icon:"info",title:"Info",text:t});break}}async function showConfirmation(t,n,e="Ya",a="Batal"){return(await Swal.fire({title:t,text:n,icon:"question",showCancelButton:!0,confirmButtonText:e,cancelButtonText:a,confirmButtonColor:"#0174BE",cancelButtonColor:"#6b7280",reverseButtons:!0,focusCancel:!0})).isConfirmed}async function showSuccess(t,n,e=2e3){await Swal.fire({title:t,text:n,icon:"success",timer:e,timerProgressBar:!0,showConfirmButton:!1})}async function showError(t,n){await Swal.fire({title:t,text:n,icon:"error",confirmButtonText:"OK",confirmButtonColor:"#ef4444"})}function showLoading(t="Memproses...",n="Mohon tunggu sebentar"){Swal.fire({title:t,text:n,icon:"info",allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>{Swal.showLoading()}})}function hideLoading(){Swal.close()}function printBill(){if(0===participants.length)return void showError("Error","Belum ada peserta yang ditambahkan");const t=generateCompactBillContent(),n=window.open("","_blank","width=800,height=600");n.document.write(`\n        <!DOCTYPE html>\n        <html>\n        <head>\n            <title>InoBill - Split Bill Receipt</title>\n            <style>\n                * {\n                    margin: 0;\n                    padding: 0;\n                    box-sizing: border-box;\n                }\n                body {\n                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n                    line-height: 1.3;\n                    color: #333;\n                    background: white;\n                    padding: 10px;\n                    font-size: 12px;\n                }\n                .header {\n                    text-align: center;\n                    margin-bottom: 15px;\n                    padding-bottom: 10px;\n                    border-bottom: 2px solid #0174BE;\n                }\n                .header h1 {\n                    color: #0174BE;\n                    margin: 0;\n                    font-size: 20px;\n                }\n                .header p {\n                    color: #666;\n                    margin: 2px 0 0 0;\n                    font-size: 11px;\n                }\n                .bill-info {\n                    background: #f8fafc;\n                    padding: 8px;\n                    border-radius: 4px;\n                    margin-bottom: 10px;\n                    border-left: 3px solid #0174BE;\n                    font-size: 11px;\n                }\n                .bill-info p {\n                    margin: 2px 0;\n                }\n                .participant-section {\n                    margin-bottom: 15px;\n                    page-break-inside: avoid;\n                }\n                .participant-header {\n                    background: #0174BE;\n                    color: white;\n                    padding: 6px 10px;\n                    border-radius: 4px 4px 0 0;\n                    font-weight: 600;\n                    font-size: 12px;\n                }\n                .participant-details {\n                    border: 1px solid #e5e7eb;\n                    border-top: none;\n                    border-radius: 0 0 4px 4px;\n                    padding: 8px;\n                }\n                .order-item {\n                    display: flex;\n                    justify-content: space-between;\n                    padding: 3px 0;\n                    border-bottom: 1px solid #f3f4f6;\n                    font-size: 11px;\n                }\n                .order-item:last-child {\n                    border-bottom: none;\n                }\n                .order-name {\n                    font-weight: 500;\n                }\n                .order-price {\n                    color: #0174BE;\n                    font-weight: 600;\n                }\n                .total-amount {\n                    background: #FFC436;\n                    color: #0C356A;\n                    padding: 6px 10px;\n                    border-radius: 4px;\n                    text-align: center;\n                    font-weight: 700;\n                    font-size: 14px;\n                    margin-top: 8px;\n                }\n                .summary-section {\n                    background: #f9fafb;\n                    padding: 10px;\n                    border-radius: 4px;\n                    margin-top: 10px;\n                    font-size: 11px;\n                }\n                .summary-item {\n                    display: flex;\n                    justify-content: space-between;\n                    padding: 3px 0;\n                    border-bottom: 1px solid #e5e7eb;\n                }\n                .summary-item:last-child {\n                    border-bottom: none;\n                    font-weight: 700;\n                    font-size: 12px;\n                    color: #0174BE;\n                }\n                .footer {\n                    text-align: center;\n                    margin-top: 15px;\n                    padding-top: 10px;\n                    border-top: 1px solid #e5e7eb;\n                    color: #666;\n                    font-size: 10px;\n                }\n                .bill-table {\n                    width: 100%;\n                    border-collapse: collapse;\n                    margin: 15px 0;\n                    font-size: 10px;\n                }\n                .bill-table th,\n                .bill-table td {\n                    border: 1px solid #ddd;\n                    padding: 4px 6px;\n                    text-align: left;\n                    vertical-align: top;\n                }\n                .bill-table th {\n                    background-color: #0174BE;\n                    color: white;\n                    font-weight: 600;\n                    text-align: center;\n                }\n                .bill-table td {\n                    background-color: white;\n                }\n                .bill-table tr:nth-child(even) td {\n                    background-color: #f9f9f9;\n                }\n                .bill-table td:first-child {\n                    font-weight: 500;\n                    background-color: #f0f8ff;\n                }\n                .bill-table td:nth-child(5),\n                .bill-table td:nth-child(7) {\n                    text-align: right;\n                    font-weight: 500;\n                }\n                .bill-table td:nth-child(3),\n                .bill-table td:nth-child(6) {\n                    text-align: center;\n                }\n                @media print {\n                    body { margin: 0; padding: 8px; }\n                    .no-print { display: none; }\n                    @page { margin: 0.5in; }\n                    .bill-table { page-break-inside: avoid; }\n                    .bill-table th,\n                    .bill-table td { font-size: 9px; padding: 2px 4px; }\n                }\n            </style>\n        </head>\n        <body>\n            ${t}\n        </body>\n        </html>\n    `),n.document.close(),n.focus(),setTimeout((()=>{n.print(),n.close()}),500),showNotification("Bill berhasil dicetak!","success")}function shareBill(){0!==participants.length?shareAsUrl():showError("Error","Belum ada peserta yang ditambahkan")}function shareAsText(){const t=generateShareText(),n=window.location.href;navigator.share?navigator.share({title:"InoBill - Split Bill Receipt",text:t,url:n}).then((()=>{showNotification("Bill berhasil dibagikan!","success")})).catch((e=>{fallbackShare(t,n)})):fallbackShare(t,n)}function shareAsLink(){Swal.fire({title:"üîó Bagikan sebagai Link",html:'\n            <div style="text-align: left; margin: 20px 0;">\n                <p style="margin-bottom: 15px; font-size: 16px; color: #374151;">\n                    Pilih cara membagikan link:\n                </p>\n                <div style="display: flex; flex-direction: column; gap: 12px;">\n                    <button id="share-url-btn" class="share-option-btn" style="\n                        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n                        color: white;\n                        border: none;\n                        padding: 12px 20px;\n                        border-radius: 8px;\n                        cursor: pointer;\n                        font-weight: 500;\n                        text-align: left;\n                    ">\n                        üåê Bagikan sebagai URL\n                    </button>\n                    <button id="share-json-btn" class="share-option-btn" style="\n                        background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n                        color: white;\n                        border: none;\n                        padding: 12px 20px;\n                        border-radius: 8px;\n                        cursor: pointer;\n                        font-weight: 500;\n                        text-align: left;\n                    ">\n                        üìÑ Bagikan sebagai JSON File\n                    </button>\n                </div>\n            </div>\n        ',showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"Batal",customClass:{popup:"swal2-popup-custom"}}),setTimeout((()=>{const t=document.getElementById("share-url-btn"),n=document.getElementById("share-json-btn");t&&t.addEventListener("click",(()=>{Swal.close(),shareAsUrl()})),n&&n.addEventListener("click",(()=>{Swal.close(),shareAsJson()}))}),100)}function shareAsUrl(){const t=generateShareableLink(),n=`üçΩÔ∏è InoBill - Split Bill Receipt\n\nLihat detail lengkap di: ${t}`;navigator.share?navigator.share({title:"InoBill - Split Bill Receipt",text:n,url:t}).then((()=>{showNotification("Link bill berhasil dibagikan!","success")})).catch((e=>{fallbackShare(n,t)})):fallbackShare(n,t)}function shareAsJson(){const t=calculateBillData();if(0===t.results.length)return void showError("Error","Belum ada data untuk dibagikan");const n={app:"InoBill PWA",version:"1.0.0",created:(new Date).toISOString(),createdBy:"InoTechno",data:{participants:participants,menuItems:menuItems,additionalCosts:additionalCosts,orders:orders,discount:discount,results:t.results,summary:t.summary}},e=JSON.stringify(n,null,2),a=new Blob([e],{type:"application/json"}),o=URL.createObjectURL(a),i=`inobill-receipt-${(new Date).toISOString().split("T")[0]}.json`,r=document.createElement("a");r.href=o,r.download=i,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o),Swal.fire({title:"‚úÖ JSON File Berhasil Dibuat!",html:`\n            <div style="text-align: left; margin: 20px 0;">\n                <p style="margin-bottom: 15px; font-size: 16px; color: #374151;">\n                    File JSON telah didownload dengan nama: <strong>${i}</strong>\n                </p>\n                <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 15px 0;">\n                    <p style="margin: 0; font-weight: 600; color: #0174BE; margin-bottom: 10px;">üìã Cara menggunakan file JSON:</p>\n                    <ol style="margin: 0; padding-left: 20px; color: #6b7280;">\n                        <li>Bagikan file JSON ke orang lain</li>\n                        <li>Buka InoBill PWA</li>\n                        <li>Klik tombol "Import JSON" di bagian atas</li>\n                        <li>Pilih file JSON yang dibagikan</li>\n                        <li>Data akan otomatis dimuat</li>\n                    </ol>\n                </div>\n                <p style="margin: 0; font-size: 14px; color: #6b7280;">\n                    üí° File JSON berisi semua data bill yang bisa dibuka di InoBill PWA\n                </p>\n            </div>\n        `,icon:"success",confirmButtonText:"Mengerti",confirmButtonColor:"#0174BE"}),showNotification("File JSON berhasil dibuat dan didownload!","success")}function fallbackShare(t,n){const e=`${t}\n\nLihat detail lengkap di: ${n}`;if(navigator.clipboard)navigator.clipboard.writeText(e).then((()=>{Swal.fire({title:"Berhasil!",text:"Bill telah disalin ke clipboard. Anda bisa paste di aplikasi lain.",icon:"success",confirmButtonText:"OK"})})).catch((()=>{showError("Error","Gagal menyalin ke clipboard")}));else{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select();try{document.execCommand("copy"),Swal.fire({title:"Berhasil!",text:"Bill telah disalin ke clipboard. Anda bisa paste di aplikasi lain.",icon:"success",confirmButtonText:"OK"})}catch(t){showError("Error","Gagal menyalin ke clipboard")}document.body.removeChild(t)}}function downloadBill(){0!==participants.length?shareAsJson():showError("Error","Belum ada peserta yang ditambahkan")}function generateBillContent(){const t=(new Date).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),n=calculateBillData();let e=`\n        <div class="header">\n            <h1>üçΩÔ∏è InoBill</h1>\n            <p>Split Bill Calculator - Dibuat oleh InoTechno</p>\n        </div>\n        \n        <div class="bill-info">\n            <p><strong>Tanggal:</strong> ${t}</p>\n            <p><strong>Total Peserta:</strong> ${participants.length} orang</p>\n            <p><strong>Total Menu:</strong> ${menuItems.length} item</p>\n        </div>\n    `;return n.results.forEach((t=>{e+=`\n            <div class="participant-section">\n                <div class="participant-header">\n                    üë§ ${t.participant}\n                </div>\n                <div class="participant-details">\n        `;const a=orders[t.participant]||[];Array.isArray(a)&&a.forEach((t=>{const n=menuItems[t.menuIndex];if(n&&t.quantity>0){const a=n.price*t.quantity;e+=`\n                        <div class="order-item">\n                            <span class="order-name">${n.name} (${t.quantity}x)</span>\n                            <span class="order-price">${formatCurrency(a)}</span>\n                        </div>\n                    `}})),e+=`\n            <div class="order-item" style="border-top: 2px solid #e5e7eb; margin-top: 10px; padding-top: 10px;">\n                <span class="order-name">Subtotal Makanan:</span>\n                <span class="order-price">${formatCurrency(t.originalAmount)}</span>\n            </div>\n            <div class="order-item">\n                <span class="order-name">Faktor Pembagi (${n.summary.factor.toFixed(4)}):</span>\n                <span class="order-price">√ó ${n.summary.factor.toFixed(4)}</span>\n            </div>\n        `,e+=`\n                    <div class="total-amount">\n                        Total: ${formatCurrency(t.adjustedAmount)}\n                    </div>\n                </div>\n            </div>\n        `})),e+=`\n        <div class="summary-section">\n            <h3 style="margin-top: 0; color: #0174BE;">üìä Ringkasan Total</h3>\n            <div class="summary-item">\n                <span>Total Menu:</span>\n                <span>${formatCurrency(n.summary.totalSubtotal)}</span>\n            </div>\n            <div class="summary-item">\n                <span>Total Biaya Tambahan:</span>\n                <span>${formatCurrency(n.summary.totalAdditionalCosts)}</span>\n            </div>\n            <div class="summary-item">\n                <span>Total Diskon:</span>\n                <span style="color: #10b981;">-${formatCurrency(n.summary.totalDiscount)}</span>\n            </div>\n            <div class="summary-item">\n                <span><strong>Grand Total:</strong></span>\n                <span><strong>${formatCurrency(n.summary.totalBill)}</strong></span>\n            </div>\n        </div>\n        \n        <div class="footer">\n            <p>Dibuat dengan ‚ù§Ô∏è oleh <strong>InoTechno</strong></p>\n            <p>InoBill PWA - Pembagi Tagihan Adil & Mudah</p>\n            <p>Website: <a href="https://inotechno.my.id" target="_blank">inotechno.my.id</a></p>\n        </div>\n    `,e}function generateCompactBillContent(){const t=(new Date).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),n=calculateBillData();let e=`\n        <div class="header">\n            <h1>üçΩÔ∏è InoBill</h1>\n            <p>Split Bill Calculator - InoTechno</p>\n        </div>\n        \n        <div class="bill-info">\n            <p><strong>Tanggal:</strong> ${t} | <strong>Peserta:</strong> ${participants.length} | <strong>Menu:</strong> ${menuItems.length}</p>\n        </div>\n    `;return e+='\n        <table class="bill-table">\n            <thead>\n                <tr>\n                    <th>Peserta</th>\n                    <th>Menu</th>\n                    <th>Qty</th>\n                    <th>Harga</th>\n                    <th>Subtotal</th>\n                    <th>Faktor</th>\n                    <th>Total</th>\n                </tr>\n            </thead>\n            <tbody>\n    ',n.results.forEach((t=>{const a=orders[t.participant]||[];let o=!1;Array.isArray(a)&&a.forEach(((a,i)=>{const r=menuItems[a.menuIndex];if(r&&a.quantity>0){const s=r.price*a.quantity,l=s*n.summary.factor;e+=`\n                        <tr>\n                            <td>${0===i?t.participant:""}</td>\n                            <td>${r.name}</td>\n                            <td>${a.quantity}</td>\n                            <td>${formatCurrency(r.price)}</td>\n                            <td>${formatCurrency(s)}</td>\n                            <td>${0===i?n.summary.factor.toFixed(4):""}</td>\n                            <td>${formatCurrency(l)}</td>\n                        </tr>\n                    `,o=!0}})),o||(e+=`\n                <tr>\n                    <td>${t.participant}</td>\n                    <td>-</td>\n                    <td>-</td>\n                    <td>-</td>\n                    <td>0</td>\n                    <td>${n.summary.factor.toFixed(4)}</td>\n                    <td>0</td>\n                </tr>\n            `)})),e+="\n            </tbody>\n        </table>\n    ",e+=`\n        <div class="summary-section">\n            <h3 style="margin-bottom: 10px; color: #0174BE; font-size: 14px;">Ringkasan</h3>\n            <div class="summary-item">\n                <span>Total Menu:</span>\n                <span>${formatCurrency(n.summary.totalSubtotal)}</span>\n            </div>\n            <div class="summary-item">\n                <span>Total Biaya Tambahan:</span>\n                <span>${formatCurrency(n.summary.totalAdditionalCosts)}</span>\n            </div>\n            <div class="summary-item">\n                <span>Total Diskon:</span>\n                <span style="color: #10b981;">-${formatCurrency(n.summary.totalDiscount)}</span>\n            </div>\n            <div class="summary-item">\n                <span><strong>Grand Total:</strong></span>\n                <span><strong>${formatCurrency(n.summary.totalBill)}</strong></span>\n            </div>\n        </div>\n        \n        <div class="footer">\n            <p>InoBill PWA - InoTechno</p>\n        </div>\n    `,e}function calculateBillData(){if(0===participants.length||0===menuItems.length)return{results:[],summary:{}};let t=0;if(Object.keys(orders).forEach((n=>{const e=orders[n]||[];Array.isArray(e)&&e.forEach((n=>{const e=menuItems[n.menuIndex];e&&(t+=e.price*n.quantity)}))})),0===t)return{results:[],summary:{}};let n=0;additionalCosts.forEach((e=>{"fixed"===e.type?n+=e.amount:"percentage"===e.type&&(n+=t*e.amount/100)}));let e=0;discount.amount>0?e=discount.amount:discount.percentage>0&&(e="menu"===discount.type?t*discount.percentage/100:(t+n)*discount.percentage/100);const a=(t+n-e)/t,o=[];return Object.keys(orders).forEach((t=>{let n=0;const e=orders[t]||[];if(Array.isArray(e)&&e.forEach((t=>{const e=menuItems[t.menuIndex];e&&(n+=e.price*t.quantity)})),n>0){const e=n*a;o.push({participant:t,originalAmount:n,adjustedAmount:e})}})),{results:o,summary:{totalSubtotal:t,totalAdditionalCosts:n,totalDiscount:e,factor:a,totalBill:t+n-e}}}function generateShareText(){const t=(new Date).toLocaleDateString("id-ID"),n=calculateBillData();if(0===n.results.length)return"Belum ada data untuk dibagikan";let e="üçΩÔ∏è *InoBill - Split Bill Receipt*\n";return e+=`üìÖ ${t}\n\n`,e+=`üë• *Peserta (${n.results.length} orang):*\n`,n.results.forEach((t=>{e+=`‚Ä¢ ${t.participant}: ${formatCurrency(t.adjustedAmount)}\n`})),e+=`\nüí∞ *Grand Total: ${formatCurrency(n.summary.totalBill)}*\n\n`,e+="Dibuat dengan InoBill PWA oleh InoTechno",e}function generateShareableLink(){const t=calculateBillData();if(0===t.results.length)return window.location.href;const n={participants:participants,menuItems:menuItems,additionalCosts:additionalCosts,orders:orders,discount:discount,results:t.results,summary:t.summary,timestamp:(new Date).toISOString()},e=btoa(JSON.stringify(n));return`${window.location.origin+window.location.pathname}?bill=${e}`}function loadDataFromUrl(){const t=new URLSearchParams(window.location.search).get("bill");if(t)try{const n=JSON.parse(atob(t));if(n.participants&&n.menuItems&&n.orders){participants=n.participants||[],menuItems=n.menuItems||[],additionalCosts=n.additionalCosts||[],orders=n.orders||{},discount=n.discount||{amount:0,percentage:0,type:"menu"},renderAll(),showNotification("Data bill berhasil dimuat dari link!","success");const t=window.location.origin+window.location.pathname;return window.history.replaceState({},document.title,t),!0}}catch(t){showError("Error","Gagal memuat data dari link")}return!1}function importJsonFile(){const t=document.createElement("input");t.type="file",t.accept=".json",t.style.display="none",document.body.appendChild(t),t.addEventListener("change",(function(n){const e=n.target.files[0];if(!e)return void document.body.removeChild(t);if(!e.name.toLowerCase().endsWith(".json"))return showError("Error","File harus berformat JSON"),void document.body.removeChild(t);const a=new FileReader;a.onload=function(n){try{const e=JSON.parse(n.target.result);if(!e.app||"InoBill PWA"!==e.app)return showError("Error","File JSON tidak valid untuk InoBill PWA"),void document.body.removeChild(t);if(!e.data)return showError("Error","File JSON tidak berisi data yang valid"),void document.body.removeChild(t);Swal.fire({title:"üìÅ Import Data JSON",html:`\n                        <div style="text-align: left; margin: 20px 0;">\n                            <p style="margin-bottom: 15px; font-size: 16px; color: #374151;">\n                                Apakah Anda yakin ingin mengimpor data dari file JSON?\n                            </p>\n                            <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 15px 0;">\n                                <p style="margin: 0; font-weight: 600; color: #0174BE; margin-bottom: 10px;">üìã Data yang akan diimpor:</p>\n                                <ul style="margin: 0; padding-left: 20px; color: #6b7280;">\n                                    <li>Peserta: ${e.data.participants?.length||0} orang</li>\n                                    <li>Menu: ${e.data.menuItems?.length||0} item</li>\n                                    <li>Biaya Tambahan: ${e.data.additionalCosts?.length||0} item</li>\n                                    <li>Dibuat: ${new Date(e.created).toLocaleDateString("id-ID")}</li>\n                                </ul>\n                            </div>\n                            <p style="margin: 0; font-size: 14px; color: #ef4444; font-weight: 600;">\n                                ‚ö†Ô∏è Data saat ini akan diganti dengan data dari file JSON!\n                            </p>\n                        </div>\n                    `,icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Import Data",cancelButtonText:"Batal",confirmButtonColor:"#0174BE",cancelButtonColor:"#6b7280",reverseButtons:!0,focusCancel:!0}).then((t=>{t.isConfirmed&&importJsonData(e.data)}))}catch(t){showError("Error","File JSON tidak valid atau rusak")}document.body.removeChild(t)},a.onerror=function(){showError("Error","Gagal membaca file"),document.body.removeChild(t)},a.readAsText(e)})),t.click()}function importJsonData(t){try{Swal.fire({title:"Sedang mengimpor...",text:"Memuat data dari file JSON...",icon:"info",allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>{Swal.showLoading()}}),setTimeout((()=>{participants=t.participants||[],menuItems=t.menuItems||[],additionalCosts=t.additionalCosts||[],orders=t.orders||{},discount=t.discount||{amount:0,percentage:0,type:"menu"},saveData(),renderAll(),Swal.fire({title:"‚úÖ Berhasil!",text:"Data JSON berhasil diimpor dan dimuat!",icon:"success",timer:2e3,timerProgressBar:!0,showConfirmButton:!1}),showNotification("Data JSON berhasil diimpor!","success")}),1e3)}catch(t){showError("Error","Gagal mengimpor data dari file JSON")}}window.addParticipant=addParticipant,window.removeParticipant=removeParticipant,window.addMenuItem=addMenuItem,window.removeMenuItem=removeMenuItem,window.addAdditionalCost=addAdditionalCost,window.removeAdditionalCost=removeAdditionalCost,window.toggleOrder=toggleOrder,window.updateOrderQuantity=updateOrderQuantity,window.toggleDiscountFields=toggleDiscountFields,window.resetAllData=resetAllData,window.toggleSelect=toggleSelect,window.selectOption=selectOption,window.getCustomSelectValue=getCustomSelectValue,window.resetCustomSelect=resetCustomSelect,document.addEventListener("DOMContentLoaded",init),window.addEventListener("load",(()=>{})),window.printBill=printBill,window.shareBill=shareBill,window.downloadBill=downloadBill,window.shareAsText=shareAsText,window.shareAsLink=shareAsLink,window.shareAsUrl=shareAsUrl,window.shareAsJson=shareAsJson,window.importJsonFile=importJsonFile;
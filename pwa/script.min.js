let participants=[],menuItems=[],additionalCosts=[],orders={},discount={amount:0,percentage:0,type:"menu"},currentTheme=localStorage.getItem("theme")||"light",lastCalculationResults=null;function formatCurrency(n){return isNaN(n)||null==n?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(n)}function formatCurrencyLegacy(n){return formatCurrency(n)}function waitForFirebase(){return new Promise((n=>{if(window.InoBillFirebase&&window.InoBillFirebase.db)return void n();const t=()=>{window.removeEventListener("firebaseReady",t),n()};window.addEventListener("firebaseReady",t);const e=()=>{window.InoBillFirebase&&window.InoBillFirebase.db?(window.removeEventListener("firebaseReady",t),n()):setTimeout(e,100)};setTimeout(e,1e3)}))}async function init(){await waitForFirebase();await loadDataFromUrl()||loadData(),setupEventListeners(),applyTheme(),loadCardStates(),renderAll()}function applyTheme(){document.documentElement.setAttribute("data-theme",currentTheme);const n=document.querySelector(".theme-icon");n&&(n.textContent="dark"===currentTheme?"‚òÄÔ∏è":"üåô")}function toggleTheme(){currentTheme="light"===currentTheme?"dark":"light",localStorage.setItem("theme",currentTheme),applyTheme(),showToast("Theme changed","success")}function loadData(){try{const n=localStorage.getItem("inobill-data");if(n){const t=JSON.parse(n);participants=t.participants||[],menuItems=t.menuItems||[],additionalCosts=t.additionalCosts||[],orders=t.orders||{},discount=t.discount||{amount:0,percentage:0,type:"menu"}}}catch(n){}}function showModal(n){const t=document.getElementById(n);if(t){t.classList.add("show"),document.body.style.overflow="hidden";const n=t.querySelector("input, select");n&&setTimeout((()=>n.focus()),300)}}function closeModal(n){const t=document.getElementById(n);if(t){t.classList.remove("show"),document.body.style.overflow="";const n=t.querySelector("form");n&&n.reset();t.querySelectorAll("input, select").forEach((n=>{"text"!==n.type&&"number"!==n.type||(n.value="")}))}}function closeModalManually(n){closeModal(n)}function showToast(n,t="success"){const e=document.createElement("div");e.className=`toast toast-${t}`;const a={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"};e.innerHTML=`\n        <span class="toast-icon">${a[t]||a.info}</span>\n        <span class="toast-message">${n}</span>\n    `,document.body.appendChild(e),setTimeout((()=>e.classList.add("show")),100),setTimeout((()=>{e.classList.remove("show"),setTimeout((()=>e.remove()),300)}),3e3)}function saveData(){try{const n={participants:participants,menuItems:menuItems,additionalCosts:additionalCosts,orders:orders,discount:discount,theme:currentTheme};localStorage.setItem("inobill-data",JSON.stringify(n))}catch(n){}}function showAddParticipantModal(){showModal("addParticipantModal")}function addParticipant(){const n=document.getElementById("participantName"),t=n.value.trim();return t?participants.includes(t)?(showToast("Participant already exists","warning"),void n.focus()):(participants.push(t),orders[t]=[],saveData(),renderParticipants(),n.value="",n.focus(),void showToast(`${t} added successfully`,"success")):(showToast("Please enter a name","error"),void n.focus())}function removeParticipant(n){const t=participants.indexOf(n);t>-1&&(participants.splice(t,1),delete orders[n],saveData(),renderParticipants(),renderOrders(),showToast(`${n} removed`,"success"))}function showAddMenuModal(){showModal("addMenuModal")}function addMenuItem(){const n=document.getElementById("menuName"),t=document.getElementById("menuPrice"),e=n.value.trim(),a=parseFloat(t.value);return e?isNaN(a)||a<0?(showToast("Please enter valid price","error"),void t.focus()):(menuItems.push({name:e,price:a}),saveData(),renderMenuItems(),n.value="",t.value="",n.focus(),void showToast(`${e} added successfully`,"success")):(showToast("Please enter item name","error"),void n.focus())}function showAddCostModal(){showModal("addCostModal")}function addAdditionalCost(){const n=document.getElementById("additionalCostName"),t=document.getElementById("additionalCostAmount"),e=document.getElementById("additionalCostType"),a=n.value.trim(),o=parseFloat(t.value),i=e.value;return a?isNaN(o)||o<0?(showToast("Please enter valid amount","error"),void t.focus()):(additionalCosts.push({name:a,amount:o,type:i}),saveData(),renderAdditionalCosts(),n.value="",t.value="",n.focus(),void showToast(`${a} added successfully`,"success")):(showToast("Please enter cost name","error"),void n.focus())}function showDiscountModal(){document.getElementById("discountAmount").value=discount.amount||"",document.getElementById("discountPercentage").value=discount.percentage||"",document.getElementById("discountType").value=discount.type||"menu",showModal("discountModal")}function applyDiscount(){const n=document.getElementById("discountAmount"),t=document.getElementById("discountPercentage"),e=document.getElementById("discountType"),a=parseFloat(n.value)||0,o=parseFloat(t.value)||0,i=e.value;return 0===a&&0===o?(showToast("Please enter discount amount or percentage","error"),void n.focus()):o>100?(showToast("Discount percentage cannot exceed 100%","error"),void t.focus()):(discount.amount=a,discount.percentage=o,discount.type=i,saveData(),renderDiscount(),n.value="",t.value="",n.focus(),void showToast("Discount applied successfully","success"))}function clearDiscount(){discount={amount:0,percentage:0,type:"menu"},saveData(),renderDiscount(),showToast("Discount cleared","success")}async function resetAllData(){if((await Swal.fire({title:"üîÑ Reset Semua Data",html:'\n            <div style="text-align: left; margin: 20px 0;">\n                <p style="margin-bottom: 15px; font-size: 16px; color: #374151;">\n                    Apakah Anda yakin ingin mengosongkan semua data?\n                </p>\n                <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 15px 0;">\n                    <p style="margin: 0; font-weight: 600; color: #ef4444; margin-bottom: 10px;">Data yang akan dihapus:</p>\n                    <ul style="margin: 0; padding-left: 20px; color: #6b7280;">\n                        <li>Semua peserta</li>\n                        <li>Semua menu</li>\n                        <li>Semua biaya tambahan</li>\n                        <li>Semua pesanan</li>\n                        <li>Semua diskon</li>\n                    </ul>\n                </div>\n                <p style="margin: 0; font-size: 14px; color: #ef4444; font-weight: 600;">\n                    ‚ö†Ô∏è Tindakan ini tidak dapat dibatalkan!\n                </p>\n            </div>\n        ',icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Reset Semua",cancelButtonText:"Batal",confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",reverseButtons:!0,focusCancel:!0,customClass:{popup:"swal2-popup-custom",title:"swal2-title-custom",htmlContainer:"swal2-html-container-custom"}})).isConfirmed){Swal.fire({title:"Sedang mereset...",text:"Menghapus semua data...",icon:"info",allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>{Swal.showLoading()}}),await new Promise((n=>setTimeout(n,1e3))),participants=[],menuItems=[],additionalCosts=[],orders={},discount={amount:0,percentage:0,type:"menu"};const n=document.getElementById("participantName"),t=document.getElementById("menuName"),e=document.getElementById("menuPrice"),a=document.getElementById("additionalCostName"),o=document.getElementById("additionalCostAmount"),i=document.getElementById("discountAmount"),s=document.getElementById("discountPercentage");n&&(n.value=""),t&&(t.value=""),e&&(e.value=""),a&&(a.value=""),o&&(o.value=""),i&&(i.value=""),s&&(s.value=""),resetCustomSelect("discountType","menu","Setelah Menu"),resetCustomSelect("additionalCostType","fixed","Tetap (Rp)");try{localStorage.removeItem("inobill_participants"),localStorage.removeItem("inobill_menuItems"),localStorage.removeItem("inobill_additionalCosts"),localStorage.removeItem("inobill_orders"),localStorage.removeItem("inobill_discount")}catch(n){}renderAll(),await Swal.fire({title:"‚úÖ Berhasil!",text:"Semua data telah direset dengan sukses!",icon:"success",timer:2e3,timerProgressBar:!0,showConfirmButton:!1})}}function setupEventListeners(){const n=document.getElementById("discountAmount"),t=document.getElementById("discountPercentage");n&&t&&(n.addEventListener("input",toggleDiscountFields),t.addEventListener("input",toggleDiscountFields)),document.addEventListener("input",debounce(saveData,1e3)),document.addEventListener("change",debounce(saveData,1e3)),window.addEventListener("online",handleOnlineStatus),window.addEventListener("offline",handleOfflineStatus),window.addEventListener("beforeunload",saveData)}function setupFloatingButton(){const n=document.getElementById("floating-reset-btn");if(n){n.addEventListener("click",(function(){this.style.transform="scale(0.95)",setTimeout((()=>{this.style.transform=""}),150)})),n.addEventListener("mouseenter",(function(){this.style.transform="translateY(-2px) scale(1.05)"})),n.addEventListener("mouseleave",(function(){this.style.transform=""}));let t=0;window.addEventListener("scroll",(function(){const e=window.pageYOffset||document.documentElement.scrollTop;e>t&&e>100?(n.style.transform="translateY(100px)",n.style.opacity="0.7"):(n.style.transform="",n.style.opacity="1"),t=e}))}}function setupModernSelects(){setupCustomSelects();document.querySelectorAll("select").forEach((n=>{n.addEventListener("change",(function(){this.style.transform="scale(0.98)",setTimeout((()=>{this.style.transform=""}),150)}))}))}function setupCustomSelects(){document.querySelectorAll(".custom-select").forEach((n=>{const t=n.querySelector(".select-trigger");n.querySelector(".select-options");t.addEventListener("mouseenter",(function(){n.classList.add("select-hovered")})),t.addEventListener("mouseleave",(function(){n.classList.remove("select-hovered")})),t.addEventListener("focus",(function(){n.classList.add("select-focused")})),t.addEventListener("blur",(function(){n.classList.remove("select-focused")})),t.addEventListener("keydown",(function(t){"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),toggleSelect(n.id||"customSelect"))}))})),document.addEventListener("click",(function(n){n.target.closest(".custom-select")||closeAllSelects()}))}function toggleSelect(n){const t=document.getElementById(n)||document.querySelector(`[onclick*="${n}"]`).closest(".custom-select"),e=t.querySelector(".select-trigger"),a=t.querySelector(".select-options");closeAllSelects(),a.classList.contains("show")?(a.classList.remove("show"),e.classList.remove("active")):(a.classList.add("show"),e.classList.add("active"))}function selectOption(n,t,e){const a=document.getElementById(n)||document.querySelector(`[onclick*="${n}"]`).closest(".custom-select"),o=a.querySelector(".select-trigger"),i=a.querySelector(".select-options"),s=a.querySelector(".select-value"),r=a.querySelectorAll(".select-option");if(s.textContent=e,r.forEach((n=>{n.classList.remove("selected"),n.dataset.value===t&&n.classList.add("selected")})),i.classList.remove("show"),o.classList.remove("active"),o.style.transform="scale(0.98)",setTimeout((()=>{o.style.transform=""}),150),"discountType"===n){showNotification("menu"===t?"Diskon akan diterapkan setelah menu":"Diskon akan diterapkan dari total semua","info")}if("additionalCostType"===n){showNotification("fixed"===t?"Biaya tambahan akan dihitung sebagai jumlah tetap":"Biaya tambahan akan dihitung sebagai persentase","info")}const l=new Event("change",{bubbles:!0});a.dispatchEvent(l)}function closeAllSelects(){document.querySelectorAll(".custom-select").forEach((n=>{const t=n.querySelector(".select-trigger");n.querySelector(".select-options").classList.remove("show"),t.classList.remove("active")}))}function getCustomSelectValue(n){try{const t=document.getElementById(n)||document.querySelector(`[onclick*="${n}"]`)?.closest(".custom-select");if(!t)return null;const e=t.querySelector(".select-option.selected");return e?e.dataset.value:null}catch(n){return null}}function resetCustomSelect(n,t,e){try{const a=document.getElementById(n)||document.querySelector(`[onclick*="${n}"]`)?.closest(".custom-select");if(!a)return;const o=a.querySelector(".select-value"),i=a.querySelectorAll(".select-option");o&&(o.textContent=e),i.forEach((n=>{n.classList.remove("selected"),n.dataset.value===t&&n.classList.add("selected")}))}catch(n){}}function toggleDiscountFields(){const n=document.getElementById("discountAmount"),t=document.getElementById("discountPercentage"),e=document.getElementById("discountInfo");if(!n||!t||!e)return;const a=parseFloat(n.value)||0,o=parseFloat(t.value)||0;a>0&&o>0?(t.value="",discount.percentage=0,discount.amount=a,e.textContent="Hanya satu jenis diskon yang diizinkan. Menggunakan diskon Rp.",e.style.display="block",e.style.color="#f59e0b",showNotification("Hanya satu jenis diskon yang diizinkan. Menggunakan diskon Rp.","warning")):a>0?(t.disabled=!0,t.style.opacity="0.5",discount.percentage=0,discount.amount=a,e.textContent="Menggunakan diskon Rp (diskon % dinonaktifkan)",e.style.display="block",e.style.color="#10b981"):o>0?(n.disabled=!0,n.style.opacity="0.5",discount.amount=0,discount.percentage=o,e.textContent="Menggunakan diskon % (diskon Rp dinonaktifkan)",e.style.display="block",e.style.color="#10b981"):(n.disabled=!1,t.disabled=!1,n.style.opacity="1",t.style.opacity="1",discount.amount=0,discount.percentage=0,e.style.display="none");try{discount.type=getCustomSelectValue("discountType")||"menu"}catch(n){discount.type="menu"}saveData(),renderDiscount(),(discount.amount>0||discount.percentage>0)&&calculateSplit()}function addParticipant(){const n=document.getElementById("participantName"),t=n.value.trim();return t?participants.includes(t)?(showError("Error Input","Peserta sudah ada"),void n.focus()):(participants.push(t),orders[t]=[],n.value="",renderParticipants(),renderOrders(),calculateSplit(),saveData(),void showNotification(`${t} berhasil ditambahkan sebagai peserta`,"success")):(showError("Error Input","Masukkan nama peserta"),void n.focus())}async function removeParticipant(n){await showConfirmation("Hapus Peserta",`Apakah Anda yakin ingin menghapus "${n}"?`,"Ya, Hapus","Batal")&&(participants=participants.filter((t=>t!==n)),delete orders[n],renderParticipants(),renderOrders(),calculateSplit(),saveData(),showNotification(`${n} telah dihapus`,"success"))}function addMenuItem(){const n=document.getElementById("menuName"),t=document.getElementById("menuPrice"),e=n.value.trim(),a=parseFloat(t.value)||0;return e?a<=0?(showError("Error Input","Masukkan harga yang valid"),void t.focus()):(menuItems.push({name:e,price:a}),n.value="",t.value="",renderMenuItems(),renderOrders(),calculateSplit(),saveData(),void showNotification(`Menu "${e}" berhasil ditambahkan`,"success")):(showError("Error Input","Masukkan nama menu"),void n.focus())}async function removeMenuItem(n){const t=menuItems[n]?.name||"menu ini";await showConfirmation("Hapus Menu",`Apakah Anda yakin ingin menghapus "${t}"?`,"Ya, Hapus","Batal")&&(menuItems.splice(n,1),Object.keys(orders).forEach((t=>{orders[t]=orders[t].filter((t=>t.menuIndex!==n))})),renderMenuItems(),renderOrders(),calculateSplit(),saveData(),showNotification(`Menu "${t}" telah dihapus`,"success"))}function addAdditionalCost(){const n=document.getElementById("additionalCostName"),t=document.getElementById("additionalCostAmount"),e=n.value.trim(),a=parseFloat(t.value)||0;let o="fixed";try{o=getCustomSelectValue("additionalCostType")||"fixed"}catch(n){o="fixed"}return e?a<=0?(showError("Error Input","Masukkan jumlah yang valid"),void t.focus()):(additionalCosts.push({name:e,amount:a,type:o}),n.value="",t.value="",renderAdditionalCosts(),calculateSplit(),saveData(),void showNotification(`Biaya tambahan "${e}" berhasil ditambahkan`,"success")):(showError("Error Input","Masukkan nama biaya tambahan"),void n.focus())}async function removeAdditionalCost(n){const t=additionalCosts[n]?.name||"biaya tambahan ini";await showConfirmation("Hapus Biaya Tambahan",`Apakah Anda yakin ingin menghapus "${t}"?`,"Ya, Hapus","Batal")&&(additionalCosts.splice(n,1),renderAdditionalCosts(),calculateSplit(),saveData(),showNotification(`Biaya tambahan "${t}" telah dihapus`,"success"))}function toggleOrder(n,t){orders[n]||(orders[n]=[]);const e=orders[n].findIndex((n=>n.menuIndex===t));e>=0?orders[n].splice(e,1):orders[n].push({menuIndex:t,quantity:1}),renderOrders(),calculateSplit(),saveData()}function updateOrderQuantity(n,t,e){orders[n]||(orders[n]=[]);const a=orders[n].findIndex((n=>n.menuIndex===t));a>=0?e<=0?orders[n].splice(a,1):orders[n][a].quantity=e:e>0&&orders[n].push({menuIndex:t,quantity:e}),renderOrders(),calculateSplit(),saveData()}function renderParticipants(){const n=document.getElementById("participantsList");n&&(0!==participants.length?n.innerHTML=participants.map((n=>`\n        <div class="participant-item">\n            <button onclick="removeParticipant('${n}')" class="remove-btn">Hapus</button>\n            <span>${n}</span>\n        </div>\n    `)).join(""):n.innerHTML='<p class="empty-state">Belum ada peserta</p>')}function renderMenuItems(){const n=document.getElementById("menuList");n&&(0!==menuItems.length?n.innerHTML=menuItems.map(((n,t)=>`\n        <div class="menu-item">\n            <button onclick="removeMenuItem(${t})" class="remove-btn">Hapus</button>\n            <span class="name">${n.name}</span>\n            <span class="price">${formatCurrency(n.price)}</span>\n        </div>\n    `)).join(""):n.innerHTML='<p class="empty-state">Belum ada menu</p>')}function renderAdditionalCosts(){const n=document.getElementById("additionalCostsList");n&&(0!==additionalCosts.length?n.innerHTML=additionalCosts.map(((n,t)=>`\n        <div class="additional-cost-item">\n            <button onclick="removeAdditionalCost(${t})" class="remove-btn">Hapus</button>\n            <span class="name">${n.name}</span>\n            <span class="amount">${"percentage"===n.type?n.amount+"%":formatCurrency(n.amount)}</span>\n        </div>\n    `)).join(""):n.innerHTML='<p class="empty-state">Belum ada biaya tambahan</p>')}function renderOrders(){const n=document.getElementById("ordersList");n&&(0!==participants.length&&0!==menuItems.length?n.innerHTML=participants.map((n=>`\n        <div class="participant-orders">\n            <h3>${n}</h3>\n            <div class="order-items">\n                ${menuItems.map(((t,e)=>{const a=orders[n]?.find((n=>n.menuIndex===e)),o=a?a.quantity:0;return`\n                        <div class="order-item">\n                            <label>\n                                <input type="checkbox" \n                                       ${o>0?"checked":""} \n                                       onchange="toggleOrder('${n}', ${e})">\n                                ${t.name} - ${formatCurrency(t.price)}\n                            </label>\n                            ${o>0?`\n                                <div class="quantity-controls">\n                                    <button onclick="updateOrderQuantity('${n}', ${e}, ${o-1})">-</button>\n                                    <span>${o}</span>\n                                    <button onclick="updateOrderQuantity('${n}', ${e}, ${o+1})">+</button>\n                                </div>\n                            `:""}\n                        </div>\n                    `})).join("")}\n            </div>\n        </div>\n    `)).join(""):n.innerHTML='<p class="empty-state">Tambahkan peserta dan menu terlebih dahulu</p>')}function calculateSplit(){if(0===participants.length||0===menuItems.length){document.getElementById("results").innerHTML='<p class="empty-state">Tambahkan peserta dan menu terlebih dahulu</p>';const n=document.getElementById("actionButtons");return void(n&&(n.style.display="none"))}let n=0;if(Object.keys(orders).forEach((t=>{orders[t].forEach((t=>{const e=menuItems[t.menuIndex];e&&(n+=e.price*t.quantity)}))})),0===n){document.getElementById("results").innerHTML='<p class="empty-state">Belum ada pesanan</p>';const n=document.getElementById("actionButtons");return void(n&&(n.style.display="none"))}let t=0;additionalCosts.forEach((e=>{"fixed"===e.type?t+=e.amount:"percentage"===e.type&&(t+=n*e.amount/100)}));let e=0;discount.amount>0?e=discount.amount:discount.percentage>0&&(e="menu"===discount.type?n*discount.percentage/100:(n+t)*discount.percentage/100);const a=(n+t-e)/n,o=[];Object.keys(orders).forEach((n=>{let t=0;if(orders[n].forEach((n=>{const e=menuItems[n.menuIndex];e&&(t+=e.price*n.quantity)})),t>0){const e=t*a;o.push({participant:n,originalAmount:t,adjustedAmount:e})}})),displayResults(o,{totalSubtotal:n,totalAdditionalCosts:t,totalDiscount:e,factor:a,totalBill:n+t-e})}function displayResults(n,t){const e=document.getElementById("results");if(!e)return;const a=n.map((n=>`\n        <div class="participant-result">\n            <h3>${n.participant}</h3>\n            <div class="result-details">\n                <div class="amount-breakdown">\n                    <span>Makanan: ${formatCurrency(n.originalAmount)}</span>\n                    <span>Total: ${formatCurrency(n.adjustedAmount)}</span>\n                </div>\n            </div>\n        </div>\n    `)).join(""),o=`\n        <div class="total-summary">\n            <h3>Grand Total: ${formatCurrency(t.totalBill)}</h3>\n            <div class="summary-breakdown">\n                <p>Subtotal: ${formatCurrency(t.totalSubtotal)}</p>\n                <p>Biaya Tambahan: ${formatCurrency(t.totalAdditionalCosts)}</p>\n                <p>Diskon: -${formatCurrency(t.totalDiscount)}</p>\n            </div>\n        </div>\n    `;e.innerHTML=a+o;const i=document.getElementById("actionButtons");i&&(i.style.display="flex")}function renderDiscount(){const n=document.getElementById("discountAmount"),t=document.getElementById("discountPercentage");if(n&&t){n.value=discount.amount||"",t.value=discount.percentage||"";try{resetCustomSelect("discountType",discount.type||"menu","menu"===discount.type?"Setelah Menu":"Dari Total Semua")}catch(n){}toggleDiscountFields()}}function renderAll(){renderParticipants(),renderMenuItems(),renderAdditionalCosts(),renderOrders(),renderDiscount(),calculateSplit()}function handleOnlineStatus(){hideOfflineIndicator(),syncData()}function handleOfflineStatus(){showOfflineIndicator()}function showOfflineIndicator(){const n=document.getElementById("offline-indicator");n&&(n.style.display="block")}function hideOfflineIndicator(){const n=document.getElementById("offline-indicator");n&&(n.style.display="none")}function syncData(){}function checkForUpdates(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((n=>{n.update()}))}function debounce(n,t){let e;return function(...a){clearTimeout(e),e=setTimeout((()=>{clearTimeout(e),n(...a)}),t)}}function formatCurrency(n){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n)}function showNotification(n,t="info"){const e={toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:n=>{n.addEventListener("mouseenter",Swal.stopTimer),n.addEventListener("mouseleave",Swal.resumeTimer)}};switch(t){case"success":Swal.fire({...e,icon:"success",title:"Berhasil!",text:n});break;case"error":Swal.fire({...e,icon:"error",title:"Error!",text:n});break;case"warning":Swal.fire({...e,icon:"warning",title:"Peringatan!",text:n});break;case"info":default:Swal.fire({...e,icon:"info",title:"Info",text:n});break}}async function showConfirmation(n,t,e="Ya",a="Batal"){return(await Swal.fire({title:n,text:t,icon:"question",showCancelButton:!0,confirmButtonText:e,cancelButtonText:a,confirmButtonColor:"#0174BE",cancelButtonColor:"#6b7280",reverseButtons:!0,focusCancel:!0})).isConfirmed}async function showSuccess(n,t,e=2e3){await Swal.fire({title:n,text:t,icon:"success",timer:e,timerProgressBar:!0,showConfirmButton:!1})}async function showError(n,t){await Swal.fire({title:n,text:t,icon:"error",confirmButtonText:"OK",confirmButtonColor:"#ef4444"})}function showLoading(n="Memproses...",t="Mohon tunggu sebentar"){Swal.fire({title:n,text:t,icon:"info",allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>{Swal.showLoading()}})}function hideLoading(){Swal.close()}function setupEventListeners(){document.addEventListener("click",(function(n){n.target.classList.contains("modal")&&closeModal(n.target.id)})),document.addEventListener("keydown",(function(n){if("Escape"===n.key){const n=document.querySelector(".modal.show");n&&closeModal(n.id)}})),document.addEventListener("keydown",(function(n){if("Enter"===n.key){const n=document.activeElement.closest(".modal");n&&("addParticipantModal"===n.id?addParticipant():"addMenuModal"===n.id?addMenuItem():"addCostModal"===n.id?addAdditionalCost():"discountModal"===n.id&&applyDiscount())}})),setInterval(saveData,5e3)}function renderParticipants(){const n=document.getElementById("participantsList");0!==participants.length?n.innerHTML=participants.map((n=>`\n        <div class="participant-item fade-in">\n            <span>${n}</span>\n            <button class="remove-btn" onclick="removeParticipant('${n}')">\n                <span>üóëÔ∏è</span>\n            </button>\n        </div>\n    `)).join(""):n.innerHTML='\n            <div class="empty-state">\n                <span class="empty-icon">üë•</span>\n                <p>No participants yet</p>\n            </div>\n        '}function renderMenuItems(){const n=document.getElementById("menuList");0!==menuItems.length?n.innerHTML=menuItems.map(((n,t)=>`\n        <div class="menu-item fade-in">\n            <span class="name">${n.name}</span>\n            <span class="price">${formatCurrency(n.price)}</span>\n            <button class="remove-btn" onclick="removeMenuItem(${t})">\n                <span>üóëÔ∏è</span>\n            </button>\n        </div>\n    `)).join(""):n.innerHTML='\n            <div class="empty-state">\n                <span class="empty-icon">üçΩÔ∏è</span>\n                <p>No menu items yet</p>\n            </div>\n        '}function renderAdditionalCosts(){const n=document.getElementById("additionalCostsList");0!==additionalCosts.length?n.innerHTML=additionalCosts.map(((n,t)=>`\n        <div class="additional-cost-item fade-in">\n            <span class="name">${n.name}</span>\n            <span class="amount">${"percentage"===n.type?n.amount+"%":formatCurrency(n.amount)}</span>\n            <button class="remove-btn" onclick="removeAdditionalCost(${t})">\n                <span>üóëÔ∏è</span>\n            </button>\n        </div>\n    `)).join(""):n.innerHTML='\n            <div class="empty-state">\n                <span class="empty-icon">üí∞</span>\n                <p>No additional costs yet</p>\n            </div>\n        '}function renderDiscount(){const n=document.getElementById("discountList");if(!discount||0===discount.amount&&0===discount.percentage)return void(n.innerHTML='\n            <div class="empty-state">\n                <span class="empty-icon">üéØ</span>\n                <p>Belum ada diskon diterapkan</p>\n            </div>\n        ');let t="",e="";discount.amount>0?(t=formatCurrency(discount.amount),e="üí∞"):discount.percentage>0&&(t=`${discount.percentage}%`,e="üìä");const a="menu"===discount.type?"Setelah Menu":"Dari Total Semua";n.innerHTML=`\n        <div class="discount-item fade-in">\n            <span class="name">\n                ${e} Diskon (${a})\n                <small style="display: block; color: #666; font-size: 0.8em; margin-top: 2px;">\n                    Hanya 1 diskon aktif\n                </small>\n            </span>\n            <span class="amount" style="color: #10b981; font-weight: 600;">\n                ${t}\n            </span>\n            <button class="remove-btn" onclick="clearDiscount()" title="Hapus diskon">\n                <span>üóëÔ∏è</span>\n            </button>\n        </div>\n    `}function renderOrders(){const n=document.getElementById("ordersList");0!==participants.length?0!==menuItems.length?n.innerHTML=participants.map((n=>{const t=orders[n]||[],e=calculateParticipantTotal(n);return`\n            <div class="participant-orders">\n                <h4>${n} ${e>0?`(${formatCurrency(e)})`:""}</h4>\n                <div class="order-items">\n                    ${menuItems.map(((e,a)=>{const o=t.find((n=>"menu"===n.type&&n.index===a)),i=o?o.quantity||1:0,s=i>0;return`\n                            <div class="order-item ${s?"selected":""}">\n                                <div class="order-checkbox">\n                                    <input type="checkbox" \n                                           ${s?"checked":""}\n                                           onchange="toggleOrder('${n}', 'menu', ${a})">\n                                </div>\n                                <div class="order-details">\n                                    <span class="name">${e.name}</span>\n                                    <span class="price">${formatCurrency(e.price)}</span>\n                                </div>\n                                <div class="quantity-controls" style="display: ${s?"flex":"none"}">\n                                    <button onclick="decreaseQuantity('${n}', ${a})" class="qty-btn">-</button>\n                                    <input type="number" \n                                           value="${i}" \n                                           min="1" \n                                           max="99"\n                                           onchange="updateQuantity('${n}', ${a}, this.value)"\n                                           class="qty-input">\n                                    <button onclick="increaseQuantity('${n}', ${a})" class="qty-btn">+</button>\n                                </div>\n                            </div>\n                        `})).join("")}\n                </div>\n            </div>\n        `})).join(""):n.innerHTML='\n            <div class="empty-state">\n                <span class="empty-icon">üìã</span>\n                <p>Add menu items first</p>\n            </div>\n        ':n.innerHTML='\n            <div class="empty-state">\n                <span class="empty-icon">üìã</span>\n                <p>Add participants first</p>\n            </div>\n        '}function renderAll(){renderParticipants(),renderMenuItems(),renderAdditionalCosts(),renderDiscount(),renderOrders()}function removeMenuItem(n){const t=menuItems[n];menuItems.splice(n,1),Object.keys(orders).forEach((t=>{orders[t]=orders[t].filter((t=>!("menu"===t.type&&t.index===n))).map((t=>"menu"===t.type&&t.index>n?{...t,index:t.index-1}:t))})),saveData(),renderMenuItems(),renderOrders(),showToast(`${t.name} removed`,"success")}function removeAdditionalCost(n){const t=additionalCosts[n];additionalCosts.splice(n,1),saveData(),renderAdditionalCosts(),renderOrders(),showToast(`${t.name} removed`,"success")}function toggleOrder(n,t,e){if(orders[n]||(orders[n]=[]),"menu"!==t)return;const a=orders[n].findIndex((n=>n.type===t&&n.index===e));-1!==a?orders[n].splice(a,1):orders[n].push({type:t,index:e,quantity:1}),saveData(),renderOrders()}function increaseQuantity(n,t){orders[n]||(orders[n]=[]);const e=orders[n].findIndex((n=>"menu"===n.type&&n.index===t));-1!==e?orders[n][e].quantity=Math.min(99,(orders[n][e].quantity||1)+1):orders[n].push({type:"menu",index:t,quantity:1}),saveData(),renderOrders()}function decreaseQuantity(n,t){if(!orders[n])return;const e=orders[n].findIndex((n=>"menu"===n.type&&n.index===t));if(-1!==e){const t=orders[n][e].quantity||1;t>1?orders[n][e].quantity=t-1:orders[n].splice(e,1)}saveData(),renderOrders()}function updateQuantity(n,t,e){orders[n]||(orders[n]=[]);const a=parseInt(e)||1;if(a<=0){const e=orders[n].findIndex((n=>"menu"===n.type&&n.index===t));-1!==e&&orders[n].splice(e,1)}else{const e=orders[n].findIndex((n=>"menu"===n.type&&n.index===t));-1!==e?orders[n][e].quantity=Math.min(99,a):orders[n].push({type:"menu",index:t,quantity:Math.min(99,a)})}saveData(),renderOrders()}function calculateParticipantTotal(n){const t=orders[n]||[];let e=0;return t.forEach((n=>{if("menu"===n.type){const t=menuItems[n.index]?.price||0,a=n.quantity||1;e+=t*a}})),e}function calculateSplit(){if(0===participants.length)return void showToast("Add participants first","warning");if(0===menuItems.length)return void showToast("Add menu items first","warning");const n={};let t=0;participants.forEach((e=>{let a=0;(orders[e]||[]).forEach((n=>{if("menu"===n.type){const e=menuItems[n.index]?.price||0,o=n.quantity||1;a+=e*o,t+=e*o}})),n[e]=a}));let e=0;const a={};additionalCosts.forEach((n=>{let o=0;o="percentage"===n.type?t*n.amount/100:n.amount,a[n.name]=o,e+=o}));let o=0,i=t,s=e;if(discount&&(discount.amount>0||discount.percentage>0))if(discount.amount>0)if(o=discount.amount,"menu"===discount.type)i=Math.max(0,t-o),s=e;else{const n=t+e,a=t/n,r=e/n;i=Math.max(0,t-o*a),s=Math.max(0,e-o*r)}else if(discount.percentage>0)if("menu"===discount.type)o=t*discount.percentage/100,i=Math.max(0,t-o),s=e;else{const n=t+e;o=n*discount.percentage/100;const a=t/n,r=e/n;i=Math.max(0,t-o*a),s=Math.max(0,e-o*r)}const r=t>0?(i+s)/t:1,l={},d={},c={};menuItems.forEach((n=>{let t=0;participants.forEach((e=>{(orders[e]||[]).forEach((e=>{"menu"===e.type&&e.index===menuItems.indexOf(n)&&(t+=e.quantity||1)}))})),d[n.name]=t,l[n.name]=n.price*t,c[n.name]=n.price*r}));const u={};let p=0;participants.forEach((t=>{const e=n[t]*r;u[t]=e,p+=e}));const m=participants.map((n=>({participant:n,amount:u[n],orders:orders[n]||[]})));displayResults(m,p,{totalFoodCost:i,additionalCostsBreakdown:a,totalDiscount:o,totalAdditionalCosts:s,grandTotal:p,factor:r,menuSubtotals:l,menuQuantities:d,menuItemDiscounts:c})}function displayResults(n,t,e=null){const a=document.getElementById("resultsSection"),o=document.getElementById("results"),i=(e&&e.additionalCostsBreakdown&&Object.entries(e.additionalCostsBreakdown).map((([n,t])=>`${n}: ${formatCurrency(t)}`)).join("<br>"),e&&e.menuSubtotals&&Object.entries(e.menuSubtotals).map((([n,t])=>{const a=e.menuQuantities[n]||0,o=menuItems.find((t=>t.name===n))?.price||0,i=e.menuItemDiscounts[n]||0,s=e.factor||1;return`\n                    <div style="display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #eee;">\n                        <div>\n                            <strong style="color: #2c5aa0;">${n}</strong><br>\n                            <small style="color: #666;">Qty: ${a} √ó ${formatCurrency(o)}</small><br>\n                            <small style="color: #666;">Subtotal: ${formatCurrency(t)}</small>\n                        </div>\n                        <div style="text-align: right;">\n                            <div style="color: #666; font-size: 0.8em;">Faktor: ${s.toFixed(4)}</div><br>\n                            <div style="color: #2c5aa0; font-weight: bold;">Harga Baru: ${formatCurrency(i)}</div>\n                        </div>\n                    </div>\n                `})).join(""),discount?discount.type:"menu");let s="";if("menu"===i){const n=e.totalFoodCost+e.totalDiscount;s=`\n            <div style="padding: 15px; background: rgba(255, 255, 255, 0.8); border-radius: 8px; border-left: 4px solid #007bff;">\n                <div style="font-weight: 600; color: #007bff; margin-bottom: 12px; display: flex; align-items: center;">\n                    <span style="margin-right: 8px;">üßÆ</span>\n                    Rincian Perhitungan\n                </div>\n                <div style="font-size: 0.9em; line-height: 1.6;">\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">\n                        <span>Total Makanan:</span>\n                        <span style="font-weight: 600;">${formatCurrency(n)}</span>\n                    </div>\n                    ${e.totalDiscount>0?`\n                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px; color: #ff6b6b;">\n                            <span>Diskon (Menu):</span>\n                            <span style="font-weight: 600;">-${formatCurrency(e.totalDiscount)}</span>\n                        </div>\n                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px; padding-top: 8px; border-top: 1px solid #dee2e6;">\n                            <span style="font-weight: 600;">Makanan Setelah Diskon:</span>\n                            <span style="font-weight: 600; color: #28a745;">${formatCurrency(e.totalFoodCost)}</span>\n                        </div>\n                    `:""}\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">\n                        <span>Biaya Tambahan:</span>\n                        <span style="font-weight: 600;">${formatCurrency(e.totalAdditionalCosts)}</span>\n                    </div>\n                </div>\n            </div>\n        `}else{const n=e.totalFoodCost+e.totalDiscount*(e.totalFoodCost/(e.totalFoodCost+e.totalAdditionalCosts)),t=e.totalAdditionalCosts+e.totalDiscount*(e.totalAdditionalCosts/(e.totalFoodCost+e.totalAdditionalCosts)),a=n+t;s=`\n            <div style="padding: 15px; background: rgba(255, 255, 255, 0.8); border-radius: 8px; border-left: 4px solid #007bff;">\n                <div style="font-weight: 600; color: #007bff; margin-bottom: 12px; display: flex; align-items: center;">\n                    <span style="margin-right: 8px;">üßÆ</span>\n                    Rincian Perhitungan\n                </div>\n                <div style="font-size: 0.9em; line-height: 1.6;">\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">\n                        <span>Total Makanan:</span>\n                        <span style="font-weight: 600;">${formatCurrency(n)}</span>\n                    </div>\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">\n                        <span>Biaya Tambahan:</span>\n                        <span style="font-weight: 600;">${formatCurrency(t)}</span>\n                    </div>\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px; padding-top: 8px; border-top: 1px solid #dee2e6;">\n                        <span style="font-weight: 600;">Subtotal:</span>\n                        <span style="font-weight: 600; color: #007bff;">${formatCurrency(a)}</span>\n                    </div>\n                    ${e.totalDiscount>0?`\n                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px; color: #ff6b6b;">\n                            <span>Diskon (Total Semua):</span>\n                            <span style="font-weight: 600;">-${formatCurrency(e.totalDiscount)}</span>\n                        </div>\n                        <div style="display: flex; justify-content: space-between; padding-top: 8px; border-top: 1px solid #dee2e6;">\n                            <span style="font-weight: 600;">Total Setelah Diskon:</span>\n                            <span style="font-weight: 600; color: #28a745;">${formatCurrency(e.grandTotal)}</span>\n                        </div>\n                    `:""}\n                </div>\n            </div>\n        `}o.innerHTML=`\n        <div class="results-list">\n            ${n.map((n=>{const t=n.orders.filter((n=>"menu"===n.type)).map((n=>{const t=menuItems[n.index],e=n.quantity||1;return`${t.name} (${e}x)`})).join(", ");return`\n                    <div class="participant-result fade-in" data-participant="${n.participant}">\n                        <div class="participant-info">\n                            <div class="participant-name">${n.participant}</div>\n                            <div class="participant-items">\n                                ${t||"Tidak ada pesanan"}\n                            </div>\n                        </div>\n                        <div class="participant-amount">\n                            ${formatCurrency(n.amount)}\n                        </div>\n                    </div>\n                `})).join("")}\n        </div>\n        <div class="total-summary">\n            <h3>Total Tagihan</h3>\n            <div class="total-amount">${formatCurrency(t)}</div>\n            <div style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 12px; border: 1px solid #dee2e6;">\n                ${s}\n                <div style="margin-top: 20px; padding: 15px; background: rgba(40, 167, 69, 0.1); border-radius: 8px; border-left: 4px solid #28a745;">\n                    <div style="font-weight: 600; color: #28a745; margin-bottom: 8px; display: flex; align-items: center;">\n                        <span style="margin-right: 8px;">üìä</span>\n                        Ringkasan Pembagian\n                    </div>\n                    <div style="font-size: 0.9em; line-height: 1.6; color: #666;">\n                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">\n                            <span>Jumlah Peserta:</span>\n                            <span style="font-weight: 600;">${participants.length} orang</span>\n                        </div>\n                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">\n                            <span>Rata-rata per orang:</span>\n                            <span style="font-weight: 600;">${formatCurrency(t/participants.length)}</span>\n                        </div>\n                        <div style="display: flex; justify-content: space-between;">\n                            <span>Faktor pembagi:</span>\n                            <span style="font-weight: 600; color: #28a745;">${e.factor?.toFixed(4)||"1.0000"}</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `,a.style.display="block",a.scrollIntoView({behavior:"smooth"}),lastCalculationResults={results:n,totalBill:t,summary:e,timestamp:new Date},showToast("Bill calculated successfully","success")}function printBill(){if(0===participants.length)return void showToast("Add participants first","warning");if(!lastCalculationResults)return void showToast("Calculate bill first","warning");const n=generateCompactBillContent(),t=window.open("","_blank","width=800,height=600");t.document.write(`\n        <!DOCTYPE html>\n        <html>\n        <head>\n            <title>InoBill - Split Bill Receipt</title>\n            <style>\n                * {\n                    margin: 0;\n                    padding: 0;\n                    box-sizing: border-box;\n                }\n                body {\n                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n                    line-height: 1.3;\n                    color: #333;\n                    background: white;\n                    padding: 10px;\n                    font-size: 12px;\n                }\n                .header {\n                    text-align: center;\n                    margin-bottom: 15px;\n                    padding-bottom: 10px;\n                    border-bottom: 2px solid #0174BE;\n                }\n                .header h1 {\n                    color: #0174BE;\n                    margin: 0;\n                    font-size: 20px;\n                }\n                .header p {\n                    color: #666;\n                    margin: 2px 0 0 0;\n                    font-size: 11px;\n                }\n                .bill-info {\n                    background: #f8fafc;\n                    padding: 8px;\n                    border-radius: 4px;\n                    margin-bottom: 10px;\n                    border-left: 3px solid #0174BE;\n                    font-size: 11px;\n                }\n                .bill-info p {\n                    margin: 2px 0;\n                }\n                .participant-section {\n                    margin-bottom: 15px;\n                    page-break-inside: avoid;\n                }\n                .participant-header {\n                    background: #0174BE;\n                    color: white;\n                    padding: 6px 10px;\n                    border-radius: 4px 4px 0 0;\n                    font-weight: 600;\n                    font-size: 12px;\n                }\n                .participant-details {\n                    border: 1px solid #e5e7eb;\n                    border-top: none;\n                    border-radius: 0 0 4px 4px;\n                    padding: 8px;\n                }\n                .order-item {\n                    display: flex;\n                    justify-content: space-between;\n                    padding: 3px 0;\n                    border-bottom: 1px solid #f3f4f6;\n                    font-size: 11px;\n                }\n                .order-item:last-child {\n                    border-bottom: none;\n                }\n                .order-name {\n                    font-weight: 500;\n                }\n                .order-price {\n                    color: #0174BE;\n                    font-weight: 600;\n                }\n                .total-amount {\n                    background: #FFC436;\n                    color: #0C356A;\n                    padding: 6px 10px;\n                    border-radius: 4px;\n                    text-align: center;\n                    font-weight: 700;\n                    font-size: 12px;\n                    margin-top: 8px;\n                }\n                .summary-section {\n                    margin-top: 20px;\n                    padding: 10px;\n                    background: #f8fafc;\n                    border-radius: 4px;\n                    border: 1px solid #e5e7eb;\n                }\n                .summary-item {\n                    display: flex;\n                    justify-content: space-between;\n                    padding: 3px 0;\n                    border-bottom: 1px solid #e5e7eb;\n                    font-size: 11px;\n                }\n                .summary-item:last-child {\n                    border-bottom: none;\n                    font-weight: 700;\n                    color: #0174BE;\n                }\n                .footer {\n                    text-align: center;\n                    margin-top: 20px;\n                    padding-top: 10px;\n                    border-top: 1px solid #e5e7eb;\n                    color: #666;\n                    font-size: 10px;\n                }\n                .bill-table {\n                    width: 100%;\n                    border-collapse: collapse;\n                    margin: 15px 0;\n                    font-size: 10px;\n                }\n                .bill-table th,\n                .bill-table td {\n                    border: 1px solid #ddd;\n                    padding: 4px 6px;\n                    text-align: left;\n                    vertical-align: top;\n                }\n                .bill-table th {\n                    background-color: #0174BE;\n                    color: white;\n                    font-weight: 600;\n                    text-align: center;\n                }\n                .bill-table td {\n                    background-color: white;\n                }\n                .bill-table tr:nth-child(even) td {\n                    background-color: #f9f9f9;\n                }\n                .bill-table td:first-child {\n                    font-weight: 500;\n                    background-color: #f0f8ff;\n                }\n                .bill-table td:nth-child(5),\n                .bill-table td:nth-child(7) {\n                    text-align: right;\n                    font-weight: 500;\n                }\n                .bill-table td:nth-child(3),\n                .bill-table td:nth-child(6) {\n                    text-align: center;\n                }\n                @media print {\n                    body { margin: 0; padding: 8px; }\n                    .no-print { display: none; }\n                    @page { margin: 0.5in; }\n                    .bill-table { page-break-inside: avoid; }\n                    .bill-table th,\n                    .bill-table td { font-size: 9px; padding: 2px 4px; }\n                }\n            </style>\n        </head>\n        <body>\n            ${n}\n        </body>\n        </html>\n    `),t.document.close(),t.focus(),setTimeout((()=>{t.print(),t.close()}),500),showToast("Bill berhasil dicetak!","success")}function shareBill(){if(navigator.share){const n=generateShareText();navigator.share({title:"InoBill - Bill Split",text:n,url:window.location.href})}else{const n=generateShareText();navigator.clipboard.writeText(n).then((()=>{showToast("Bill details copied to clipboard","success")}))}}function generateCompactBillContent(){const n=(new Date).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});if(!lastCalculationResults)return`\n            <div class="header">\n                <h1>üçΩÔ∏è InoBill</h1>\n                <p>Split Bill Calculator - Dibuat oleh InoTechno</p>\n            </div>\n            <div class="bill-info">\n                <p><strong>Tanggal:</strong> ${n}</p>\n            </div>\n            <div style="text-align: center; padding: 40px; color: #666;">\n                <h2>Belum ada data untuk dicetak</h2>\n                <p>Silakan hitung tagihan terlebih dahulu</p>\n            </div>\n        `;const{results:t,totalBill:e,summary:a}=lastCalculationResults;let o=`\n        <div class="header">\n            <h1>üçΩÔ∏è InoBill</h1>\n            <p>Split Bill Calculator - Dibuat oleh InoTechno</p>\n        </div>\n        \n        <div class="bill-info">\n            <p><strong>Tanggal:</strong> ${n}</p>\n            <p><strong>Total Peserta:</strong> ${participants.length} orang</p>\n            <p><strong>Total Menu:</strong> ${menuItems.length} item</p>\n        </div>\n    `;t&&t.length>0?t.forEach((n=>{o+=`\n                <div class="participant-section">\n                    <div class="participant-header">\n                        üë§ ${n.participant}\n                    </div>\n                    <div class="participant-details">\n            `;const t=n.orders||[];t.length>0?t.forEach((n=>{if("menu"===n.type&&menuItems[n.index]){const t=menuItems[n.index],e=n.quantity||1,a=t.price*e;o+=`\n                            <div class="order-item">\n                                <span class="order-name">${t.name} (${e}x)</span>\n                                <span class="order-price">${formatCurrency(a)}</span>\n                            </div>\n                        `}})):o+=`\n                    <div class="order-item">\n                        <span class="order-name">Tidak ada pesanan</span>\n                        <span class="order-price">${formatCurrency(0)}</span>\n                    </div>\n                `,o+=`\n                        <div class="total-amount">\n                            Total: ${formatCurrency(n.amount||0)}\n                        </div>\n                    </div>\n                </div>\n            `})):o+=`\n            <div class="participant-section">\n                <div class="participant-header">\n                    üë§ Tidak ada peserta\n                </div>\n                <div class="participant-details">\n                    <div class="order-item">\n                        <span class="order-name">Tidak ada data</span>\n                        <span class="order-price">${formatCurrency(0)}</span>\n                    </div>\n                    <div class="total-amount">\n                        Total: ${formatCurrency(0)}\n                    </div>\n                </div>\n            </div>\n        `;const i=a?.totalFoodCost||0,s=a?.totalAdditionalCosts||0,r=a?.totalDiscount||0,l=e||0;return o+=`\n        <div class="summary-section">\n            <h3 style="margin-bottom: 10px; color: #0174BE; font-size: 14px;">Ringkasan</h3>\n            <div class="summary-item">\n                <span>Total Menu:</span>\n                <span>${formatCurrency(i)}</span>\n            </div>\n            <div class="summary-item">\n                <span>Total Biaya Tambahan:</span>\n                <span>${formatCurrency(s)}</span>\n            </div>\n            <div class="summary-item">\n                <span>Total Diskon:</span>\n                <span style="color: #10b981;">-${formatCurrency(r)}</span>\n            </div>\n            <div class="summary-item">\n                <span><strong>Grand Total:</strong></span>\n                <span><strong>${formatCurrency(l)}</strong></span>\n            </div>\n        </div>\n        \n        <div class="footer">\n            <p>InoBill PWA - InoTechno</p>\n        </div>\n    `,o}function generatePrintContent(){const n=(new Date).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});if(!lastCalculationResults)return`\n            <div class="header">\n                <h1>InoBill - Bill Receipt</h1>\n                <p>Split Bill Calculator</p>\n                <p>Tanggal: ${n}</p>\n            </div>\n            <div style="text-align: center; padding: 40px; color: #666;">\n                <h2>Belum ada data untuk dicetak</h2>\n                <p>Silakan hitung tagihan terlebih dahulu</p>\n            </div>\n        `;const{results:t,totalBill:e,summary:a}=lastCalculationResults;let o="";return additionalCosts.length>0&&(o=additionalCosts.map((n=>{if("percentage"===n.type){const t=participants.reduce(((n,t)=>n+(orders[t]||[]).filter((n=>"menu"===n.type)).reduce(((n,t)=>n+(menuItems[t.index]?.price||0)),0)),0)*n.amount/100;return`<div class="breakdown-item"><span>${n.name} (${n.amount}%)</span><span>${formatCurrency(t)}</span></div>`}return`<div class="breakdown-item"><span>${n.name}</span><span>${formatCurrency(n.amount)}</span></div>`})).join("")),`\n        <div class="header">\n            <h1>InoBill - Bill Receipt</h1>\n            <p>Split Bill Calculator</p>\n            <p>Tanggal: ${n}</p>\n        </div>\n        \n        <div class="participants">\n            ${t.map((n=>{const t=n.orders||[];let e=0;return t.forEach((n=>{if("menu"===n.type){const t=menuItems[n.index]?.price||0,a=n.quantity||1;e+=t*a}})),`\n                    <div class="participant">\n                        <div class="participant-name">${n.participant}</div>\n                        <div class="participant-details">\n                            Makanan: ${formatCurrency(e)}\n                        </div>\n                        <div class="participant-amount">${formatCurrency(n.amount)}</div>\n                    </div>\n                `})).join("")}\n        </div>\n        \n        <div class="total-summary">\n            <h2>Total Tagihan</h2>\n            <div class="total-amount">${formatCurrency(e)}</div>\n        </div>\n        \n        ${o?`\n            <div class="breakdown">\n                <h3>Detail Biaya Tambahan</h3>\n                ${o}\n            </div>\n        `:""}\n        \n        <div class="breakdown">\n            <h3>Ringkasan Pembagian</h3>\n            <div class="breakdown-item">\n                <span>Jumlah Peserta:</span>\n                <span>${participants.length} orang</span>\n            </div>\n            <div class="breakdown-item">\n                <span>Rata-rata per orang:</span>\n                <span>${formatCurrency(e/participants.length)}</span>\n            </div>\n        </div>\n        \n        <div class="footer">\n            <p>Dibuat dengan InoBill - Split Bill Calculator</p>\n            <p>¬© ${(new Date).getFullYear()} InoTechno</p>\n        </div>\n    `}function generateShareText(){let n="InoBill - Bill Split Results\n\n";additionalCosts.length>0&&(n+="Additional Costs:\n",additionalCosts.forEach((t=>{"percentage"===t.type?n+=`- ${t.name}: ${t.amount}%\n`:n+=`- ${t.name}: ${formatCurrency(t.amount)}\n`})),n+="\n"),participants.forEach((t=>{const e=calculateParticipantTotal(t);n+=`${t}: ${formatCurrency(e)}\n`}));const t=participants.reduce(((n,t)=>n+calculateParticipantTotal(t)),0);return n+=`\nTotal: ${formatCurrency(t)}`,n}function importJsonFile(){const n=document.createElement("input");n.type="file",n.accept=".json",n.onchange=function(n){const t=n.target.files[0];if(t){const n=new FileReader;n.onload=function(n){try{const t=JSON.parse(n.target.result);participants=t.participants||[],menuItems=t.menuItems||[],additionalCosts=t.additionalCosts||[],orders=t.orders||{},discount=t.discount||{amount:0,percentage:0,type:"menu"},saveData(),renderAll(),showToast("Data imported successfully","success")}catch(n){showToast("Error importing file","error")}},n.readAsText(t)}},n.click()}async function resetAllData(){if((await Swal.fire({title:"üîÑ Reset All Data",html:'\n            <div style="text-align: left; margin: 20px 0;">\n                <p style="margin-bottom: 15px; font-size: 16px; color: #374151;">\n                    Are you sure you want to clear all data?\n                </p>\n                <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 15px 0;">\n                    <p style="margin: 0; font-weight: 600; color: #ef4444; margin-bottom: 10px;">Data that will be deleted:</p>\n                    <ul style="margin: 0; padding-left: 20px; color: #6b7280;">\n                        <li>All participants</li>\n                        <li>All menu items</li>\n                        <li>All additional costs</li>\n                        <li>All orders</li>\n                        <li>All discounts</li>\n                    </ul>\n                </div>\n            </div>\n        ',icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, Reset All",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed){participants=[],menuItems=[],additionalCosts=[],orders={},discount={amount:0,percentage:0,type:"menu"},saveData(),renderAll();const n=document.getElementById("resultsSection");n&&(n.style.display="none"),showToast("All data has been reset","success")}}function formatCurrency(n){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(n)}function formatCurrencyLegacy(n){return formatCurrency(n)}function printBill(){if(0===participants.length)return void showError("Error","Belum ada peserta yang ditambahkan");const n=generateSimplePrintContent(),t=window.open("","_blank","width=800,height=600");t.document.write(`\n        <!DOCTYPE html>\n        <html>\n        <head>\n            <title>InoBill - Split Bill Receipt</title>\n            <style>\n                * {\n                    margin: 0;\n                    padding: 0;\n                    box-sizing: border-box;\n                }\n                body {\n                    font-family: Arial, sans-serif;\n                    line-height: 1.3;\n                    color: #333;\n                    background: white;\n                    padding: 15px;\n                    font-size: 12px;\n                    margin: 0;\n                }\n                .header {\n                    text-align: center;\n                    margin-bottom: 15px;\n                    padding-bottom: 10px;\n                    border-bottom: 2px solid #0174BE;\n                }\n                .header h1 {\n                    color: #0174BE;\n                    margin: 0;\n                    font-size: 20px;\n                }\n                .header p {\n                    color: #666;\n                    margin: 3px 0 0 0;\n                    font-size: 11px;\n                }\n                .bill-info {\n                    background: #f8fafc;\n                    padding: 10px;\n                    border-radius: 5px;\n                    margin-bottom: 15px;\n                    border-left: 3px solid #0174BE;\n                    font-size: 11px;\n                }\n                .bill-info p {\n                    margin: 2px 0;\n                }\n                .print-table {\n                    width: 100%;\n                    border-collapse: collapse;\n                    margin-bottom: 15px;\n                    font-size: 11px;\n                }\n                .print-table th,\n                .print-table td {\n                    border: 1px solid #ddd;\n                    padding: 6px 8px;\n                    text-align: left;\n                    vertical-align: top;\n                }\n                .print-table th {\n                    background-color: #0174BE;\n                    color: white;\n                    font-weight: 600;\n                    text-align: center;\n                    font-size: 11px;\n                }\n                .print-table td {\n                    background-color: white;\n                }\n                .print-table tr:nth-child(even) td {\n                    background-color: #f9f9f9;\n                }\n                .print-table td:first-child {\n                    font-weight: 500;\n                    background-color: #f0f8ff;\n                    text-align: right;\n                    vertical-align: middle;\n                }\n                .print-table td:nth-child(2) {\n                    text-align: right;\n                }\n                .print-table td:nth-child(3),\n                .print-table td:nth-child(4),\n                .print-table td:nth-child(5) {\n                    text-align: right;\n                }\n                .print-table td:last-child {\n                    vertical-align: middle;\n                }\n                .summary-table {\n                    width: 100%;\n                    border-collapse: collapse;\n                    margin-bottom: 15px;\n                    font-size: 11px;\n                }\n                .summary-table td {\n                    border: 1px solid #ddd;\n                    padding: 6px 8px;\n                    text-align: left;\n                }\n                .summary-table td:last-child {\n                    text-align: right;\n                    font-weight: 600;\n                }\n                .footer {\n                    text-align: center;\n                    margin-top: 20px;\n                    padding-top: 15px;\n                    border-top: 1px solid #ddd;\n                    color: #666;\n                    font-size: 10px;\n                }\n                @media print {\n                    body { margin: 0; padding: 10px; }\n                    @page { \n                        margin: 0.3in; \n                        size: A4;\n                    }\n                    .print-table { \n                        page-break-inside: avoid; \n                        font-size: 10px;\n                    }\n                    .print-table th,\n                    .print-table td { \n                        font-size: 9px; \n                        padding: 4px 6px; \n                    }\n                    .summary-table {\n                        page-break-inside: avoid;\n                        font-size: 10px;\n                    }\n                    .summary-table td {\n                        font-size: 9px;\n                        padding: 4px 6px;\n                    }\n                }\n            </style>\n        </head>\n        <body>\n            ${n}\n        </body>\n        </html>\n    `),t.document.close(),t.focus(),setTimeout((()=>{t.print(),t.close()}),500),showNotification("Bill berhasil dicetak!","success")}async function shareBill(){if(0!==participants.length)if(lastCalculationResults)try{const n=await generateShareableLink(),t=`üçΩÔ∏è InoBill - Split Bill Receipt\n\nLihat detail lengkap di: ${n}`;navigator.share?navigator.share({title:"InoBill - Split Bill Receipt",text:t,url:n}).then((()=>{showNotification("Bill berhasil dibagikan!","success")})).catch((n=>{fallbackShare(t)})):fallbackShare(t)}catch(n){showError("Error","Gagal membagikan bill")}else showError("Error","Hitung tagihan terlebih dahulu");else showError("Error","Belum ada peserta yang ditambahkan")}function shareAsText(){const n=generateShareText();navigator.share?navigator.share({title:"InoBill - Split Bill Receipt",text:n}).then((()=>{showNotification("Bill berhasil dibagikan!","success")})).catch((t=>{fallbackShare(n)})):fallbackShare(n)}function shareAsLink(){Swal.fire({title:"üîó Bagikan sebagai Link",html:'\n            <div style="text-align: left; margin: 20px 0;">\n                <p style="margin-bottom: 15px; font-size: 16px; color: #374151;">\n                    Pilih cara membagikan link:\n                </p>\n                <div style="display: flex; flex-direction: column; gap: 12px;">\n                    <button id="share-url-btn" class="share-option-btn" style="\n                        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n                        color: white;\n                        border: none;\n                        padding: 12px 20px;\n                        border-radius: 8px;\n                        cursor: pointer;\n                        font-weight: 500;\n                        text-align: left;\n                    ">\n                        üåê Bagikan sebagai URL\n                    </button>\n                    <button id="share-json-btn" class="share-option-btn" style="\n                        background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n                        color: white;\n                        border: none;\n                        padding: 12px 20px;\n                        border-radius: 8px;\n                        cursor: pointer;\n                        font-weight: 500;\n                        text-align: left;\n                    ">\n                        üìÑ Bagikan sebagai JSON File\n                    </button>\n                </div>\n            </div>\n        ',showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"Batal",customClass:{popup:"swal2-popup-custom"}}),setTimeout((()=>{const n=document.getElementById("share-url-btn"),t=document.getElementById("share-json-btn");n&&n.addEventListener("click",(()=>{Swal.close(),shareAsUrl()})),t&&t.addEventListener("click",(()=>{Swal.close(),shareAsJson()}))}),100)}async function shareAsUrl(){try{const n=await generateShareableLink(),t=`üçΩÔ∏è InoBill - Split Bill Receipt\n\nLihat detail lengkap di: ${n}`;navigator.share?navigator.share({title:"InoBill - Split Bill Receipt",text:t,url:n}).then((()=>{showNotification("Link bill berhasil dibagikan!","success")})).catch((e=>{fallbackShare(t,n)})):fallbackShare(t,n)}catch(n){showError("Error","Gagal membagikan link")}}function shareAsJson(){if(0===participants.length)return void showError("Error","Belum ada peserta yang ditambahkan");const n={app:"InoBill PWA",version:"1.0.0",created:(new Date).toISOString(),createdBy:"InoTechno",data:{participants:participants,menuItems:menuItems,additionalCosts:additionalCosts,orders:orders,discount:discount}},t=JSON.stringify(n,null,2),e=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(e),o=`inobill-receipt-${(new Date).toISOString().split("T")[0]}.json`,i=document.createElement("a");i.href=a,i.download=o,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a),Swal.fire({title:"‚úÖ JSON File Berhasil Dibuat!",html:`\n            <div style="text-align: left; margin: 20px 0;">\n                <p style="margin-bottom: 15px; font-size: 16px; color: #374151;">\n                    File JSON telah didownload dengan nama: <strong>${o}</strong>\n                </p>\n                <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 15px 0;">\n                    <p style="margin: 0; font-weight: 600; color: #0174BE; margin-bottom: 10px;">üìã Cara menggunakan file JSON:</p>\n                    <ol style="margin: 0; padding-left: 20px; color: #6b7280;">\n                        <li>Bagikan file JSON ke orang lain</li>\n                        <li>Buka InoBill PWA</li>\n                        <li>Klik tombol "Import JSON" di bagian atas</li>\n                        <li>Pilih file JSON yang dibagikan</li>\n                        <li>Data akan otomatis dimuat</li>\n                    </ol>\n                </div>\n                <p style="margin: 0; font-size: 14px; color: #6b7280;">\n                    üí° File JSON berisi semua data bill yang bisa dibuka di InoBill PWA\n                </p>\n            </div>\n        `,icon:"success",confirmButtonText:"Mengerti",confirmButtonColor:"#0174BE"}),showNotification("File JSON berhasil dibuat dan didownload!","success")}function fallbackShare(n){if(navigator.clipboard)navigator.clipboard.writeText(n).then((()=>{Swal.fire({title:"Berhasil!",text:"Bill telah disalin ke clipboard. Anda bisa paste di aplikasi lain.",icon:"success",confirmButtonText:"OK"})})).catch((()=>{showError("Error","Gagal menyalin ke clipboard")}));else{const t=document.createElement("textarea");t.value=n,document.body.appendChild(t),t.select();try{document.execCommand("copy"),Swal.fire({title:"Berhasil!",text:"Bill telah disalin ke clipboard. Anda bisa paste di aplikasi lain.",icon:"success",confirmButtonText:"OK"})}catch(n){showError("Error","Gagal menyalin ke clipboard")}document.body.removeChild(t)}}function downloadBill(){0!==participants.length?lastCalculationResults?shareAsJson():showError("Error","Hitung tagihan terlebih dahulu"):showError("Error","Belum ada peserta yang ditambahkan")}async function shareAsImage(){if(0!==participants.length)if(lastCalculationResults)try{showLoading("Generating Image...","Creating bill image for sharing");const n=document.createElement("div");n.id="temp-image-container",n.style.cssText="\n            position: fixed;\n            top: -9999px;\n            left: -9999px;\n            width: 800px;\n            background: white;\n            padding: 20px;\n            font-family: Arial, sans-serif;\n            color: #333;\n            line-height: 1.4;\n        ";const t=generateSimplePrintContent();n.innerHTML=t;const e=document.createElement("style");e.textContent="\n            #temp-image-container .header {\n                text-align: center;\n                margin-bottom: 20px;\n                padding-bottom: 15px;\n                border-bottom: 2px solid #0174BE;\n            }\n            #temp-image-container .header h1 {\n                color: #0174BE;\n                margin: 0;\n                font-size: 24px;\n            }\n            #temp-image-container .header p {\n                color: #666;\n                margin: 5px 0 0 0;\n                font-size: 14px;\n            }\n            #temp-image-container .bill-info {\n                background: #f8fafc;\n                padding: 15px;\n                border-radius: 8px;\n                margin-bottom: 20px;\n                border-left: 4px solid #0174BE;\n                font-size: 13px;\n            }\n            #temp-image-container .bill-info p {\n                margin: 3px 0;\n            }\n            #temp-image-container .print-table {\n                width: 100%;\n                border-collapse: collapse;\n                margin-bottom: 20px;\n                font-size: 12px;\n            }\n            #temp-image-container .print-table th,\n            #temp-image-container .print-table td {\n                border: 1px solid #ddd;\n                padding: 8px 10px;\n                text-align: left;\n                vertical-align: top;\n            }\n            #temp-image-container .print-table th {\n                background-color: #0174BE;\n                color: white;\n                font-weight: 600;\n                text-align: center;\n                font-size: 12px;\n            }\n            #temp-image-container .print-table td {\n                background-color: white;\n            }\n            #temp-image-container .print-table tr:nth-child(even) td {\n                background-color: #f9f9f9;\n            }\n            #temp-image-container .print-table td:first-child {\n                font-weight: 500;\n                background-color: #f0f8ff;\n                text-align: right;\n                vertical-align: middle;\n            }\n            #temp-image-container .print-table td:nth-child(2),\n            #temp-image-container .print-table td:nth-child(3),\n            #temp-image-container .print-table td:nth-child(4),\n            #temp-image-container .print-table td:nth-child(5) {\n                text-align: right;\n            }\n            #temp-image-container .summary-table {\n                width: 100%;\n                border-collapse: collapse;\n                margin-top: 20px;\n                font-size: 12px;\n            }\n            #temp-image-container .summary-table td {\n                border: 1px solid #ddd;\n                padding: 8px 10px;\n                text-align: left;\n            }\n            #temp-image-container .summary-table td:last-child {\n                text-align: right;\n                font-weight: 600;\n            }\n            #temp-image-container .footer {\n                text-align: center;\n                margin-top: 30px;\n                padding-top: 15px;\n                border-top: 1px solid #ddd;\n                color: #666;\n                font-size: 11px;\n            }\n        ",n.appendChild(e),document.body.appendChild(n);const a=await html2canvas(n,{width:800,height:n.scrollHeight,scale:2,backgroundColor:"#ffffff",useCORS:!0,allowTaint:!0});document.body.removeChild(n);const o=await new Promise((n=>{a.toBlob(n,"image/png",.95)})),i=`inobill-receipt-${(new Date).toISOString().split("T")[0]}.png`,s=URL.createObjectURL(o),r=document.createElement("a");r.href=s,r.download=i,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s),showNotification("Bill image berhasil didownload!","success")}catch(n){showError("Error","Gagal membuat gambar bill. Silakan coba lagi.")}else showError("Error","Hitung tagihan terlebih dahulu");else showError("Error","Belum ada peserta yang ditambahkan")}function generateBillContent(){const n=(new Date).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),t=calculateBillData();let e=`\n        <div class="header">\n            <h1>üçΩÔ∏è InoBill</h1>\n            <p>Split Bill Calculator - Dibuat oleh InoTechno</p>\n        </div>\n        \n        <div class="bill-info">\n            <p><strong>Tanggal:</strong> ${n}</p>\n            <p><strong>Total Peserta:</strong> ${participants.length} orang</p>\n            <p><strong>Total Menu:</strong> ${menuItems.length} item</p>\n        </div>\n    `;return t.results.forEach((n=>{e+=`\n            <div class="participant-section">\n                <div class="participant-header">\n                    üë§ ${n.participant}\n                </div>\n                <div class="participant-details">\n        `;const t=orders[n.participant]||[];Array.isArray(t)&&t.forEach((n=>{const t=menuItems[n.menuIndex];if(t&&n.quantity>0){const a=t.price*n.quantity;e+=`\n                        <div class="order-item">\n                            <span class="order-name">${t.name} (${n.quantity}x)</span>\n                            <span class="order-price">${formatCurrency(a)}</span>\n                        </div>\n                    `}})),e+=`\n            <div class="order-item" style="border-top: 2px solid #e5e7eb; margin-top: 10px; padding-top: 10px;">\n                <span class="order-name">Subtotal Makanan:</span>\n                <span class="order-price">${formatCurrency(n.originalAmount)}</span>\n            </div>\n        `,e+=`\n                    <div class="total-amount">\n                        Total: ${formatCurrency(n.adjustedAmount)}\n                    </div>\n                </div>\n            </div>\n        `})),e+=`\n        <div class="summary-section">\n            <h3 style="margin-top: 0; color: #0174BE;">üìä Ringkasan Total</h3>\n            <div class="summary-item">\n                <span>Total Menu:</span>\n                <span>${formatCurrency(t.summary.totalSubtotal)}</span>\n            </div>\n            <div class="summary-item">\n                <span>Total Biaya Tambahan:</span>\n                <span>${formatCurrency(t.summary.totalAdditionalCosts)}</span>\n            </div>\n            <div class="summary-item">\n                <span>Total Diskon:</span>\n                <span style="color: #10b981;">-${formatCurrency(t.summary.totalDiscount)}</span>\n            </div>\n            <div class="summary-item">\n                <span><strong>Grand Total:</strong></span>\n                <span><strong>${formatCurrency(t.summary.totalBill)}</strong></span>\n            </div>\n        </div>\n        \n        <div class="footer">\n            <p>Dibuat dengan ‚ù§Ô∏è oleh <strong>InoTechno</strong></p>\n            <p>InoBill PWA - Pembagi Tagihan Adil & Mudah</p>\n            <p>Website: <a href="https://inotechno.my.id" target="_blank">inotechno.my.id</a></p>\n        </div>\n    `,e}function generateCompactBillContent(){const n=(new Date).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),t=calculateBillData();let e=`\n        <div class="header">\n            <h1>üçΩÔ∏è InoBill</h1>\n            <p>Split Bill Calculator - InoTechno</p>\n        </div>\n        \n        <div class="bill-info">\n            <p><strong>Tanggal:</strong> ${n} | <strong>Peserta:</strong> ${participants.length} | <strong>Menu:</strong> ${menuItems.length}</p>\n        </div>\n    `;return e+='\n        <table class="bill-table">\n            <thead>\n                <tr>\n                    <th>Peserta</th>\n                    <th>Menu</th>\n                    <th>Qty</th>\n                    <th>Harga</th>\n                    <th>Subtotal</th>\n                    <th>Total</th>\n                </tr>\n            </thead>\n            <tbody>\n    ',t.results.forEach((n=>{const a=orders[n.participant]||[];let o=!1;Array.isArray(a)&&a.forEach(((a,i)=>{const s=menuItems[a.menuIndex];if(s&&a.quantity>0){const r=s.price*a.quantity,l=r*t.summary.factor;e+=`\n                        <tr>\n                            <td>${0===i?n.participant:""}</td>\n                            <td>${s.name}</td>\n                            <td>${a.quantity}</td>\n                            <td>${formatCurrency(s.price)}</td>\n                            <td>${formatCurrency(r)}</td>\n                            <td>${formatCurrency(l)}</td>\n                        </tr>\n                    `,o=!0}})),o||(e+=`\n                <tr>\n                    <td>${n.participant}</td>\n                    <td>-</td>\n                    <td>-</td>\n                    <td>-</td>\n                    <td>0</td>\n                    <td>0</td>\n                </tr>\n            `)})),e+="\n            </tbody>\n        </table>\n    ",e+='\n        <table class="bill-table" style="margin: 20px 0;">\n            <thead>\n                <tr>\n                    <th style="background-color: #0174BE; color: white; font-weight: 600;">Peserta</th>\n                    <th style="background-color: #0174BE; color: white; font-weight: 600;">Total Bayar</th>\n                </tr>\n            </thead>\n            <tbody>\n    ',t.results.forEach((n=>{e+=`\n            <tr>\n                <td style="font-weight: 600; background-color: #f0f8ff;">${n.participant}</td>\n                <td style="text-align: right; font-weight: 700; color: #0174BE;">${formatCurrency(n.adjustedAmount)}</td>\n            </tr>\n        `})),e+="\n            </tbody>\n        </table>\n    ",e+=`\n        <div class="summary-section">\n            <h3 style="margin-bottom: 10px; color: #0174BE; font-size: 14px;">Ringkasan</h3>\n            <div class="summary-item">\n                <span>Total Menu:</span>\n                <span>${formatCurrency(t.summary.totalSubtotal)}</span>\n            </div>\n            <div class="summary-item">\n                <span>Total Biaya Tambahan:</span>\n                <span>${formatCurrency(t.summary.totalAdditionalCosts)}</span>\n            </div>\n            <div class="summary-item">\n                <span>Total Diskon:</span>\n                <span style="color: #10b981;">-${formatCurrency(t.summary.totalDiscount)}</span>\n            </div>\n            <div class="summary-item">\n                <span><strong>Grand Total:</strong></span>\n                <span><strong>${formatCurrency(t.summary.totalBill)}</strong></span>\n            </div>\n        </div>\n        \n        <div class="footer">\n            <p>InoBill PWA - InoTechno</p>\n        </div>\n    `,e}function calculateBillData(){if(0===participants.length||0===menuItems.length)return{results:[],summary:{}};let n=0;if(Object.keys(orders).forEach((t=>{const e=orders[t]||[];Array.isArray(e)&&e.forEach((t=>{const e=menuItems[t.menuIndex];e&&(n+=e.price*t.quantity)}))})),0===n)return{results:[],summary:{}};let t=0;additionalCosts.forEach((e=>{"fixed"===e.type?t+=e.amount:"percentage"===e.type&&(t+=n*e.amount/100)}));let e=0;discount.amount>0?e=discount.amount:discount.percentage>0&&(e="menu"===discount.type?n*discount.percentage/100:(n+t)*discount.percentage/100);const a=(n+t-e)/n,o=[];return Object.keys(orders).forEach((n=>{let t=0;const e=orders[n]||[];if(Array.isArray(e)&&e.forEach((n=>{const e=menuItems[n.menuIndex];e&&(t+=e.price*n.quantity)})),t>0){const e=t*a;o.push({participant:n,originalAmount:t,adjustedAmount:e})}})),{results:o,summary:{totalSubtotal:n,totalAdditionalCosts:t,totalDiscount:e,factor:a,totalBill:n+t-e}}}function generateShareText(){if(!lastCalculationResults)return"Belum ada data untuk dibagikan";const{results:n,totalBill:t,summary:e}=lastCalculationResults,a=(new Date).toLocaleDateString("id-ID");if(0===n.length)return"Belum ada data untuk dibagikan";let o="üçΩÔ∏è *InoBill - Split Bill Receipt*\n";return o+=`üìÖ ${a}\n\n`,o+=`üë• *Peserta (${n.length} orang):*\n`,n.forEach((n=>{o+=`‚Ä¢ ${n.participant}: ${formatCurrency(n.amount)}\n`})),o+=`\nüí∞ *Grand Total: ${formatCurrency(t)}*\n\n`,o+="Dibuat dengan InoBill PWA oleh InoTechno",o}function generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){const t=16*Math.random()|0;return("x"==n?t:3&t|8).toString(16)}))}async function saveToFirebase(n,t){const e={...n,expires_at:Date.now()+6048e5,created_at:Date.now()};try{window.InoBillFirebase||await waitForFirebase();const{db:n,collection:a,addDoc:o}=window.InoBillFirebase;await o(a(n,"shared_bills"),{id:t,data:e,created_at:e.created_at,expires_at:e.expires_at});return localStorage.setItem(`inobill_shared_${t}`,JSON.stringify(e)),t}catch(n){return localStorage.setItem(`inobill_shared_${t}`,JSON.stringify(e)),t}}async function generateShareableLink(){try{const n=generateUUID(),t={participants:participants,menuItems:menuItems,additionalCosts:additionalCosts,orders:orders,discount:discount,timestamp:(new Date).toISOString()},e=(await saveToFirebase(t,n),window.location.origin+window.location.pathname);return`${e}?id=${n}`}catch(n){const t={participants:participants,menuItems:menuItems,additionalCosts:additionalCosts,orders:orders,discount:discount,timestamp:(new Date).toISOString()},e=JSON.stringify(t).replace(/"type":"menu"/g,'"t":"m"').replace(/"quantity":/g,'"q":').replace(/"index":/g,'"i":').replace(/"amount":/g,'"a":').replace(/"percentage":/g,'"p":').replace(/"name":/g,'"n":').replace(/"price":/g,'"p":'),a=btoa(e);return`${window.location.origin+window.location.pathname}?bill=${a}`}}async function loadFromFirebase(n){try{window.InoBillFirebase||await waitForFirebase();const{db:t,collection:e,getDocs:a,query:o,where:i}=window.InoBillFirebase,s=o(e(t,"shared_bills"),i("id","==",n)),r=await a(s);if(r.empty){const t=localStorage.getItem(`inobill_shared_${n}`);if(t){const e=JSON.parse(t);if(e.expires_at&&Date.now()>e.expires_at)throw localStorage.removeItem(`inobill_shared_${n}`),new Error("File has expired");return e}throw new Error("Document not found")}{const n=r.docs[0].data();if(n.expires_at&&Date.now()>n.expires_at)throw new Error("Document has expired");if(n.data)return n.data;{const{id:t,created_at:e,expires_at:a,...o}=n;return o}}}catch(n){throw n}}async function loadDataFromUrl(){const n=new URLSearchParams(window.location.search),t=n.get("id"),e=n.get("bill");if(t)try{const n=await loadFromFirebase(t);if(n.participants&&n.menuItems&&n.orders){participants=n.participants||[],menuItems=n.menuItems||[],additionalCosts=n.additionalCosts||[],orders=n.orders||{},discount=n.discount||{amount:0,percentage:0,type:"menu"},saveData(),renderAll(),showNotification("Data bill berhasil dimuat dari link!","success");const t=window.location.origin+window.location.pathname;return window.history.replaceState({},document.title,t),!0}showError("Error","Data dari file tidak valid")}catch(n){"Document has expired"===n.message?showError("Error","Data sudah expired (lebih dari 7 hari)"):"Document not found"===n.message?showError("Error","Data tidak ditemukan"):showError("Error","Gagal memuat data dari Firebase: "+n.message)}if(e)try{const n=JSON.parse(atob(e)),t=n.participants||n.p,a=n.menuItems||n.m,o=n.additionalCosts||n.a,i=n.orders||n.o,s=n.discount||n.d;if(t&&a&&i){participants=t||[],menuItems=a||[],additionalCosts=o||[],orders=i||{},discount=s||{amount:0,percentage:0,type:"menu"},saveData(),renderAll(),showNotification("Data bill berhasil dimuat dari link!","success");const n=window.location.origin+window.location.pathname;return window.history.replaceState({},document.title,n),!0}showError("Error","Data dari link tidak valid")}catch(n){showError("Error","Gagal memuat data dari link")}return!1}function generateSimplePrintContent(){const n=(new Date).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),t=(new Date).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"});let e=0,a=0,o=0;participants.forEach((n=>{const t=orders[n]||[];Array.isArray(t)&&t.length>0&&t.forEach((n=>{if(n&&"menu"===n.type&&"number"==typeof n.index&&n.quantity>0){const t=menuItems[n.index];t&&(e+=t.price*n.quantity)}}))})),additionalCosts.forEach((n=>{"fixed"===n.type?a+=n.amount||0:"percentage"===n.type&&(a+=e*(n.amount||0)/100)})),discount&&(discount.amount>0||discount.percentage>0)&&(discount.amount>0?o=discount.amount:discount.percentage>0&&(o="menu"===discount.type?e*discount.percentage/100:(e+a)*discount.percentage/100));const i=e>0?(e+a-o)/e:1;let s=`\n        <div class="header">\n            <h1>üçΩÔ∏è InoBill</h1>\n            <p>Smart Bill Splitter</p>\n        </div>\n        \n        <div class="bill-info">\n            <p><strong>Tanggal:</strong> ${n}</p>\n            <p><strong>Waktu:</strong> ${t}</p>\n            <p><strong>Total Peserta:</strong> ${participants.length} orang</p>\n        </div>\n        \n        <table class="print-table">\n            <thead>\n                <tr>\n                    <th>Peserta</th>\n                    <th>Menu</th>\n                    <th>Qty</th>\n                    <th>Harga</th>\n                    <th>Subtotal</th>\n                </tr>\n            </thead>\n            <tbody>\n    `;participants.forEach((n=>{const t=orders[n]||[];let e=!1,a=0,o=[];if(Array.isArray(t)&&t.length>0&&t.forEach((n=>{if(n&&"menu"===n.type&&"number"==typeof n.index&&n.quantity>0){const t=menuItems[n.index];if(t){t.price,n.quantity;const s=t.price*i,r=s*n.quantity;a+=r,o.push({name:t.name,quantity:n.quantity,price:s,total:r}),e=!0}}})),e&&o.length>0){s+=`\n                <tr>\n                    <td rowspan="${o.length}">${n}</td>\n                    <td>${o[0].name}</td>\n                    <td>${o[0].quantity}</td>\n                    <td>${formatCurrency(o[0].price)}</td>\n                    <td rowspan="${o.length}">${formatCurrency(a)}</td>\n                </tr>\n            `;for(let n=1;n<o.length;n++)s+=`\n                    <tr>\n                        <td>${o[n].name}</td>\n                        <td>${o[n].quantity}</td>\n                        <td>${formatCurrency(o[n].price)}</td>\n                    </tr>\n                `}else s+=`\n                <tr>\n                    <td>${n}</td>\n                    <td>-</td>\n                    <td>-</td>\n                    <td>-</td>\n                    <td>${formatCurrency(0)}</td>\n                </tr>\n            `})),s+='\n            </tbody>\n        </table>\n        \n        <table class="summary-table">\n            <tbody>\n    ',s+=`\n        <tr>\n            <td><strong>Sub Total</strong></td>\n            <td>${formatCurrency(e)}</td>\n        </tr>\n    `,additionalCosts.length>0&&additionalCosts.forEach((n=>{let t=0;"fixed"===n.type?t=n.amount||0:"percentage"===n.type&&(t=e*(n.amount||0)/100),s+=`\n                <tr>\n                    <td><strong>${n.name}</strong></td>\n                    <td>${formatCurrency(t)}</td>\n                </tr>\n            `})),discount&&(discount.amount>0||discount.percentage>0)&&(discount.amount>0?s+=`\n                <tr>\n                    <td><strong>Diskon (${"menu"===discount.type?"Setelah Menu":"Dari Total Semua"})</strong></td>\n                    <td style="color: #10b981;">-${formatCurrency(o)}</td>\n                </tr>\n            `:discount.percentage>0&&(s+=`\n                <tr>\n                    <td><strong>Diskon ${discount.percentage}% (${"menu"===discount.type?"Setelah Menu":"Dari Total Semua"})</strong></td>\n                    <td style="color: #10b981;">-${formatCurrency(o)}</td>\n                </tr>\n            `));return s+=`\n        <tr style="border-top: 2px solid #0174BE; font-weight: bold; font-size: 14px;">\n            <td><strong>TOTAL</strong></td>\n            <td><strong>${formatCurrency(e+a-o)}</strong></td>\n        </tr>\n    `,s+='\n            </tbody>\n        </table>\n        \n        <div class="footer">\n            <p>Dibuat dengan InoBill PWA oleh InoTechno</p>\n            <p>inotechno.my.id</p>\n        </div>\n    ',s}function importJsonFile(){const n=document.createElement("input");n.type="file",n.accept=".json",n.style.display="none",document.body.appendChild(n),n.addEventListener("change",(function(t){const e=t.target.files[0];if(!e)return void document.body.removeChild(n);if(!e.name.toLowerCase().endsWith(".json"))return showError("Error","File harus berformat JSON"),void document.body.removeChild(n);const a=new FileReader;a.onload=function(t){try{const e=JSON.parse(t.target.result);if(!e.app||"InoBill PWA"!==e.app)return showError("Error","File JSON tidak valid untuk InoBill PWA"),void document.body.removeChild(n);if(!e.data)return showError("Error","File JSON tidak berisi data yang valid"),void document.body.removeChild(n);Swal.fire({title:"üìÅ Import Data JSON",html:`\n                        <div style="text-align: left; margin: 20px 0;">\n                            <p style="margin-bottom: 15px; font-size: 16px; color: #374151;">\n                                Apakah Anda yakin ingin mengimpor data dari file JSON?\n                            </p>\n                            <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 15px 0;">\n                                <p style="margin: 0; font-weight: 600; color: #0174BE; margin-bottom: 10px;">üìã Data yang akan diimpor:</p>\n                                <ul style="margin: 0; padding-left: 20px; color: #6b7280;">\n                                    <li>Peserta: ${e.data.participants?.length||0} orang</li>\n                                    <li>Menu: ${e.data.menuItems?.length||0} item</li>\n                                    <li>Biaya Tambahan: ${e.data.additionalCosts?.length||0} item</li>\n                                    <li>Dibuat: ${new Date(e.created).toLocaleDateString("id-ID")}</li>\n                                </ul>\n                            </div>\n                            <p style="margin: 0; font-size: 14px; color: #ef4444; font-weight: 600;">\n                                ‚ö†Ô∏è Data saat ini akan diganti dengan data dari file JSON!\n                            </p>\n                        </div>\n                    `,icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Import Data",cancelButtonText:"Batal",confirmButtonColor:"#0174BE",cancelButtonColor:"#6b7280",reverseButtons:!0,focusCancel:!0}).then((n=>{n.isConfirmed&&importJsonData(e.data)}))}catch(n){showError("Error","File JSON tidak valid atau rusak")}document.body.removeChild(n)},a.onerror=function(){showError("Error","Gagal membaca file"),document.body.removeChild(n)},a.readAsText(e)})),n.click()}function importJsonData(n){try{Swal.fire({title:"Sedang mengimpor...",text:"Memuat data dari file JSON...",icon:"info",allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>{Swal.showLoading()}}),setTimeout((()=>{participants=n.participants||[],menuItems=n.menuItems||[],additionalCosts=n.additionalCosts||[],orders=n.orders||{},discount=n.discount||{amount:0,percentage:0,type:"menu"},saveData(),renderAll(),Swal.fire({title:"‚úÖ Berhasil!",text:"Data JSON berhasil diimpor dan dimuat!",icon:"success",timer:2e3,timerProgressBar:!0,showConfirmButton:!1}),showNotification("Data JSON berhasil diimpor!","success")}),1e3)}catch(n){showError("Error","Gagal mengimpor data dari file JSON")}}function showDiscountModal(){const n=document.getElementById("discountAmount"),t=document.getElementById("discountPercentage"),e=(document.getElementById("discountType"),document.getElementById("discountInfo"));n&&(n.value=discount.amount||""),t&&(t.value=discount.percentage||""),e&&(e.style.display="none");try{resetCustomSelect("discountType",discount.type||"menu","menu"===discount.type?"Setelah Menu":"Dari Total Semua")}catch(n){}showModal("discountModal"),setTimeout((()=>{n&&n.focus()}),100)}function applyDiscount(){const n=document.getElementById("discountAmount"),t=document.getElementById("discountPercentage");if(!n||!t)return void showError("Error","Form discount tidak ditemukan");const e=parseFloat(n.value)||0,a=parseFloat(t.value)||0;if(0===e&&0===a)return showError("Error Input","Masukkan nilai diskon (Rp atau %)"),void n.focus();if(e<0||a<0)return void showError("Error Input","Nilai diskon tidak boleh negatif");if(a>100)return showError("Error Input","Diskon persentase tidak boleh lebih dari 100%"),void t.focus();e>0&&a>0&&(t.value="",showNotification("Hanya satu jenis diskon yang diizinkan. Menggunakan diskon Rp.","warning"));let o="menu";try{o=getCustomSelectValue("discountType")||"menu"}catch(n){}discount={amount:e>0?e:0,percentage:e>0?0:a,type:o},saveData(),renderDiscount(),calculateSplit(),closeModal("discountModal");showNotification(`Diskon ${discount.amount>0?`Rp ${formatCurrency(discount.amount)}`:`${discount.percentage}%`} (${"menu"===discount.type?"setelah menu":"dari total semua"}) berhasil diterapkan`,"success")}function clearDiscount(){discount={amount:0,percentage:0,type:"menu"},saveData(),renderDiscount(),calculateSplit(),showNotification("Diskon berhasil dihapus","success")}function showModal(n){const t=document.getElementById(n);t&&(t.classList.add("show"),document.body.classList.add("modal-open"),document.body.style.overflow="hidden")}function closeModal(n){const t=document.getElementById(n);t&&(t.classList.remove("show"),document.body.classList.remove("modal-open"),document.body.style.overflow="")}function closeModalManually(n){closeModal(n)}function toggleCardCollapse(n){const t=document.getElementById(n).closest(".card"),e=t.querySelector(".collapse-icon");t.classList.contains("collapsed")?(t.classList.remove("collapsed"),e.textContent="‚ñº",localStorage.setItem(`card-${n}-collapsed`,"false")):(t.classList.add("collapsed"),e.textContent="‚ñ∂",localStorage.setItem(`card-${n}-collapsed`,"true"))}function loadCardStates(){["participantsCard","menuCard","additionalCostsCard","discountCard","ordersCard","resultsCard"].forEach((n=>{const t="true"===localStorage.getItem(`card-${n}-collapsed`),e=document.getElementById(n);if(e){const n=e.closest(".card"),a=n.querySelector(".collapse-icon");t&&(n.classList.add("collapsed"),a&&(a.textContent="‚ñ∂"))}}))}window.addParticipant=addParticipant,window.removeParticipant=removeParticipant,window.addMenuItem=addMenuItem,window.removeMenuItem=removeMenuItem,window.addAdditionalCost=addAdditionalCost,window.removeAdditionalCost=removeAdditionalCost,window.toggleOrder=toggleOrder,window.updateOrderQuantity=updateOrderQuantity,window.toggleDiscountFields=toggleDiscountFields,window.resetAllData=resetAllData,window.toggleSelect=toggleSelect,window.selectOption=selectOption,window.getCustomSelectValue=getCustomSelectValue,window.resetCustomSelect=resetCustomSelect,window.showAddParticipantModal=showAddParticipantModal,window.showAddMenuModal=showAddMenuModal,window.showAddCostModal=showAddCostModal,window.showDiscountModal=showDiscountModal,window.addParticipant=addParticipant,window.addMenuItem=addMenuItem,window.addAdditionalCost=addAdditionalCost,window.applyDiscount=applyDiscount,window.removeParticipant=removeParticipant,window.removeMenuItem=removeMenuItem,window.removeAdditionalCost=removeAdditionalCost,window.toggleOrder=toggleOrder,window.calculateSplit=calculateSplit,window.printBill=printBill,window.shareBill=shareBill,window.importJsonFile=importJsonFile,window.resetAllData=resetAllData,window.toggleTheme=toggleTheme,window.closeModal=closeModal,document.addEventListener("DOMContentLoaded",init),window.addEventListener("load",(()=>{})),window.printBill=printBill,window.shareBill=shareBill,window.downloadBill=downloadBill,window.shareAsText=shareAsText,window.shareAsLink=shareAsLink,window.shareAsUrl=shareAsUrl,window.shareAsJson=shareAsJson,window.importJsonFile=importJsonFile,window.closeModalManually=closeModalManually,window.clearDiscount=clearDiscount,window.increaseQuantity=increaseQuantity,window.decreaseQuantity=decreaseQuantity,window.updateQuantity=updateQuantity,window.showDiscountModal=showDiscountModal,window.showModal=showModal,window.closeModal=closeModal,window.toggleCardCollapse=toggleCardCollapse;